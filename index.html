<!DOCTYPE html> <html lang=en><!--
 Page saved with SingleFile 
--><meta charset=utf-8>
<title>LightMate</title>
<meta name=viewport content="width=device-width, initial-scale=1">
<script src="data:text/javascript;base64,LyoKICogQ29weXJpZ2h0IChjKSAyMDIyLCBKZWZmIEhseXdhIChqaGx5d2FAZ21haWwuY29tKQogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogKiBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqCiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgpjb25zdCBTWU1CT0xTID0gJ3BuYnJxa1BOQlJRSycKCmNvbnN0IERFRkFVTFRfUE9TSVRJT04gPQogICdybmJxa2Juci9wcHBwcHBwcC84LzgvOC84L1BQUFBQUFBQL1JOQlFLQk5SIHcgS1FrcSAtIDAgMScKCmNvbnN0IFRFUk1JTkFUSU9OX01BUktFUlMgPSBbJzEtMCcsICcwLTEnLCAnMS8yLTEvMicsICcqJ10KCmNvbnN0IFBBV05fT0ZGU0VUUyA9IHsKICBiOiBbMTYsIDMyLCAxNywgMTVdLAogIHc6IFstMTYsIC0zMiwgLTE3LCAtMTVdLAp9Cgpjb25zdCBQSUVDRV9PRkZTRVRTID0gewogIG46IFstMTgsIC0zMywgLTMxLCAtMTQsIDE4LCAzMywgMzEsIDE0XSwKICBiOiBbLTE3LCAtMTUsIDE3LCAxNV0sCiAgcjogWy0xNiwgMSwgMTYsIC0xXSwKICBxOiBbLTE3LCAtMTYsIC0xNSwgMSwgMTcsIDE2LCAxNSwgLTFdLAogIGs6IFstMTcsIC0xNiwgLTE1LCAxLCAxNywgMTYsIDE1LCAtMV0sCn0KCi8vIHByZXR0aWVyLWlnbm9yZQpjb25zdCBBVFRBQ0tTID0gWwogIDIwLCAwLCAwLCAwLCAwLCAwLCAwLCAyNCwgIDAsIDAsIDAsIDAsIDAsIDAsMjAsIDAsCiAgIDAsMjAsIDAsIDAsIDAsIDAsIDAsIDI0LCAgMCwgMCwgMCwgMCwgMCwyMCwgMCwgMCwKICAgMCwgMCwyMCwgMCwgMCwgMCwgMCwgMjQsICAwLCAwLCAwLCAwLDIwLCAwLCAwLCAwLAogICAwLCAwLCAwLDIwLCAwLCAwLCAwLCAyNCwgIDAsIDAsIDAsMjAsIDAsIDAsIDAsIDAsCiAgIDAsIDAsIDAsIDAsMjAsIDAsIDAsIDI0LCAgMCwgMCwyMCwgMCwgMCwgMCwgMCwgMCwKICAgMCwgMCwgMCwgMCwgMCwyMCwgMiwgMjQsICAyLDIwLCAwLCAwLCAwLCAwLCAwLCAwLAogICAwLCAwLCAwLCAwLCAwLCAyLDUzLCA1NiwgNTMsIDIsIDAsIDAsIDAsIDAsIDAsIDAsCiAgMjQsMjQsMjQsMjQsMjQsMjQsNTYsICAwLCA1NiwyNCwyNCwyNCwyNCwyNCwyNCwgMCwKICAgMCwgMCwgMCwgMCwgMCwgMiw1MywgNTYsIDUzLCAyLCAwLCAwLCAwLCAwLCAwLCAwLAogICAwLCAwLCAwLCAwLCAwLDIwLCAyLCAyNCwgIDIsMjAsIDAsIDAsIDAsIDAsIDAsIDAsCiAgIDAsIDAsIDAsIDAsMjAsIDAsIDAsIDI0LCAgMCwgMCwyMCwgMCwgMCwgMCwgMCwgMCwKICAgMCwgMCwgMCwyMCwgMCwgMCwgMCwgMjQsICAwLCAwLCAwLDIwLCAwLCAwLCAwLCAwLAogICAwLCAwLDIwLCAwLCAwLCAwLCAwLCAyNCwgIDAsIDAsIDAsIDAsMjAsIDAsIDAsIDAsCiAgIDAsMjAsIDAsIDAsIDAsIDAsIDAsIDI0LCAgMCwgMCwgMCwgMCwgMCwyMCwgMCwgMCwKICAyMCwgMCwgMCwgMCwgMCwgMCwgMCwgMjQsICAwLCAwLCAwLCAwLCAwLCAwLDIwCl07CgovLyBwcmV0dGllci1pZ25vcmUKY29uc3QgUkFZUyA9IFsKICAgMTcsICAwLCAgMCwgIDAsICAwLCAgMCwgIDAsIDE2LCAgMCwgIDAsICAwLCAgMCwgIDAsICAwLCAxNSwgMCwKICAgIDAsIDE3LCAgMCwgIDAsICAwLCAgMCwgIDAsIDE2LCAgMCwgIDAsICAwLCAgMCwgIDAsIDE1LCAgMCwgMCwKICAgIDAsICAwLCAxNywgIDAsICAwLCAgMCwgIDAsIDE2LCAgMCwgIDAsICAwLCAgMCwgMTUsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgMTcsICAwLCAgMCwgIDAsIDE2LCAgMCwgIDAsICAwLCAxNSwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgIDAsIDE3LCAgMCwgIDAsIDE2LCAgMCwgIDAsIDE1LCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgIDAsICAwLCAxNywgIDAsIDE2LCAgMCwgMTUsICAwLCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgIDAsICAwLCAgMCwgMTcsIDE2LCAxNSwgIDAsICAwLCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDEsICAxLCAgMSwgIDEsICAxLCAgMSwgIDEsICAwLCAtMSwgLTEsICAtMSwtMSwgLTEsIC0xLCAtMSwgMCwKICAgIDAsICAwLCAgMCwgIDAsICAwLCAgMCwtMTUsLTE2LC0xNywgIDAsICAwLCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgIDAsICAwLC0xNSwgIDAsLTE2LCAgMCwtMTcsICAwLCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwgIDAsLTE1LCAgMCwgIDAsLTE2LCAgMCwgIDAsLTE3LCAgMCwgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLCAgMCwtMTUsICAwLCAgMCwgIDAsLTE2LCAgMCwgIDAsICAwLC0xNywgIDAsICAwLCAgMCwgMCwKICAgIDAsICAwLC0xNSwgIDAsICAwLCAgMCwgIDAsLTE2LCAgMCwgIDAsICAwLCAgMCwtMTcsICAwLCAgMCwgMCwKICAgIDAsLTE1LCAgMCwgIDAsICAwLCAgMCwgIDAsLTE2LCAgMCwgIDAsICAwLCAgMCwgIDAsLTE3LCAgMCwgMCwKICAtMTUsICAwLCAgMCwgIDAsICAwLCAgMCwgIDAsLTE2LCAgMCwgIDAsICAwLCAgMCwgIDAsICAwLC0xNwpdOwoKY29uc3QgU0hJRlRTID0geyBwOiAwLCBuOiAxLCBiOiAyLCByOiAzLCBxOiA0LCBrOiA1IH0KCmNvbnN0IEJJVFMgPSB7CiAgTk9STUFMOiAxLAogIENBUFRVUkU6IDIsCiAgQklHX1BBV046IDQsCiAgRVBfQ0FQVFVSRTogOCwKICBQUk9NT1RJT046IDE2LAogIEtTSURFX0NBU1RMRTogMzIsCiAgUVNJREVfQ0FTVExFOiA2NCwKfQoKY29uc3QgUkFOS18xID0gNwpjb25zdCBSQU5LXzIgPSA2CmNvbnN0IFJBTktfMyA9IDUKY29uc3QgUkFOS180ID0gNApjb25zdCBSQU5LXzUgPSAzCmNvbnN0IFJBTktfNiA9IDIKY29uc3QgUkFOS183ID0gMQpjb25zdCBSQU5LXzggPSAwCgovLyBwcmV0dGllci1pZ25vcmUKY29uc3QgU1FVQVJFX01BUCA9IHsKICBhODogICAwLCBiODogICAxLCBjODogICAyLCBkODogICAzLCBlODogICA0LCBmODogICA1LCBnODogICA2LCBoODogICA3LAogIGE3OiAgMTYsIGI3OiAgMTcsIGM3OiAgMTgsIGQ3OiAgMTksIGU3OiAgMjAsIGY3OiAgMjEsIGc3OiAgMjIsIGg3OiAgMjMsCiAgYTY6ICAzMiwgYjY6ICAzMywgYzY6ICAzNCwgZDY6ICAzNSwgZTY6ICAzNiwgZjY6ICAzNywgZzY6ICAzOCwgaDY6ICAzOSwKICBhNTogIDQ4LCBiNTogIDQ5LCBjNTogIDUwLCBkNTogIDUxLCBlNTogIDUyLCBmNTogIDUzLCBnNTogIDU0LCBoNTogIDU1LAogIGE0OiAgNjQsIGI0OiAgNjUsIGM0OiAgNjYsIGQ0OiAgNjcsIGU0OiAgNjgsIGY0OiAgNjksIGc0OiAgNzAsIGg0OiAgNzEsCiAgYTM6ICA4MCwgYjM6ICA4MSwgYzM6ICA4MiwgZDM6ICA4MywgZTM6ICA4NCwgZjM6ICA4NSwgZzM6ICA4NiwgaDM6ICA4NywKICBhMjogIDk2LCBiMjogIDk3LCBjMjogIDk4LCBkMjogIDk5LCBlMjogMTAwLCBmMjogMTAxLCBnMjogMTAyLCBoMjogMTAzLAogIGExOiAxMTIsIGIxOiAxMTMsIGMxOiAxMTQsIGQxOiAxMTUsIGUxOiAxMTYsIGYxOiAxMTcsIGcxOiAxMTgsIGgxOiAxMTkKfTsKCmNvbnN0IFJPT0tTID0gewogIHc6IFsKICAgIHsgc3F1YXJlOiBTUVVBUkVfTUFQLmExLCBmbGFnOiBCSVRTLlFTSURFX0NBU1RMRSB9LAogICAgeyBzcXVhcmU6IFNRVUFSRV9NQVAuaDEsIGZsYWc6IEJJVFMuS1NJREVfQ0FTVExFIH0sCiAgXSwKICBiOiBbCiAgICB7IHNxdWFyZTogU1FVQVJFX01BUC5hOCwgZmxhZzogQklUUy5RU0lERV9DQVNUTEUgfSwKICAgIHsgc3F1YXJlOiBTUVVBUkVfTUFQLmg4LCBmbGFnOiBCSVRTLktTSURFX0NBU1RMRSB9LAogIF0sCn0KCmNvbnN0IFBBUlNFUl9TVFJJQ1QgPSAwCmNvbnN0IFBBUlNFUl9TTE9QUFkgPSAxCgovKiB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gdW5pcXVlbHkgaWRlbnRpZnkgYW1iaWd1b3VzIG1vdmVzICovCmZ1bmN0aW9uIGdldF9kaXNhbWJpZ3VhdG9yKG1vdmUsIG1vdmVzKSB7CiAgdmFyIGZyb20gPSBtb3ZlLmZyb20KICB2YXIgdG8gPSBtb3ZlLnRvCiAgdmFyIHBpZWNlID0gbW92ZS5waWVjZQoKICB2YXIgYW1iaWd1aXRpZXMgPSAwCiAgdmFyIHNhbWVfcmFuayA9IDAKICB2YXIgc2FtZV9maWxlID0gMAoKICBmb3IgKHZhciBpID0gMCwgbGVuID0gbW92ZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgIHZhciBhbWJpZ19mcm9tID0gbW92ZXNbaV0uZnJvbQogICAgdmFyIGFtYmlnX3RvID0gbW92ZXNbaV0udG8KICAgIHZhciBhbWJpZ19waWVjZSA9IG1vdmVzW2ldLnBpZWNlCgogICAgLyogaWYgYSBtb3ZlIG9mIHRoZSBzYW1lIHBpZWNlIHR5cGUgZW5kcyBvbiB0aGUgc2FtZSB0byBzcXVhcmUsIHdlJ2xsCiAgICAgKiBuZWVkIHRvIGFkZCBhIGRpc2FtYmlndWF0b3IgdG8gdGhlIGFsZ2VicmFpYyBub3RhdGlvbgogICAgICovCiAgICBpZiAocGllY2UgPT09IGFtYmlnX3BpZWNlICYmIGZyb20gIT09IGFtYmlnX2Zyb20gJiYgdG8gPT09IGFtYmlnX3RvKSB7CiAgICAgIGFtYmlndWl0aWVzKysKCiAgICAgIGlmIChyYW5rKGZyb20pID09PSByYW5rKGFtYmlnX2Zyb20pKSB7CiAgICAgICAgc2FtZV9yYW5rKysKICAgICAgfQoKICAgICAgaWYgKGZpbGUoZnJvbSkgPT09IGZpbGUoYW1iaWdfZnJvbSkpIHsKICAgICAgICBzYW1lX2ZpbGUrKwogICAgICB9CiAgICB9CiAgfQoKICBpZiAoYW1iaWd1aXRpZXMgPiAwKSB7CiAgICAvKiBpZiB0aGVyZSBleGlzdHMgYSBzaW1pbGFyIG1vdmluZyBwaWVjZSBvbiB0aGUgc2FtZSByYW5rIGFuZCBmaWxlIGFzCiAgICAgKiB0aGUgbW92ZSBpbiBxdWVzdGlvbiwgdXNlIHRoZSBzcXVhcmUgYXMgdGhlIGRpc2FtYmlndWF0b3IKICAgICAqLwogICAgaWYgKHNhbWVfcmFuayA+IDAgJiYgc2FtZV9maWxlID4gMCkgewogICAgICByZXR1cm4gYWxnZWJyYWljKGZyb20pCiAgICB9IGVsc2UgaWYgKHNhbWVfZmlsZSA+IDApIHsKICAgICAgLyogaWYgdGhlIG1vdmluZyBwaWVjZSByZXN0cyBvbiB0aGUgc2FtZSBmaWxlLCB1c2UgdGhlIHJhbmsgc3ltYm9sIGFzIHRoZQogICAgICAgKiBkaXNhbWJpZ3VhdG9yCiAgICAgICAqLwogICAgICByZXR1cm4gYWxnZWJyYWljKGZyb20pLmNoYXJBdCgxKQogICAgfSBlbHNlIHsKICAgICAgLyogZWxzZSB1c2UgdGhlIGZpbGUgc3ltYm9sICovCiAgICAgIHJldHVybiBhbGdlYnJhaWMoZnJvbSkuY2hhckF0KDApCiAgICB9CiAgfQoKICByZXR1cm4gJycKfQoKZnVuY3Rpb24gaW5mZXJfcGllY2VfdHlwZShzYW4pIHsKICB2YXIgcGllY2VfdHlwZSA9IHNhbi5jaGFyQXQoMCkKICBpZiAocGllY2VfdHlwZSA+PSAnYScgJiYgcGllY2VfdHlwZSA8PSAnaCcpIHsKICAgIHZhciBtYXRjaGVzID0gc2FuLm1hdGNoKC9bYS1oXVxkLipbYS1oXVxkLykKICAgIGlmIChtYXRjaGVzKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQKICAgIH0KICAgIHJldHVybiBQQVdOCiAgfQogIHBpZWNlX3R5cGUgPSBwaWVjZV90eXBlLnRvTG93ZXJDYXNlKCkKICBpZiAocGllY2VfdHlwZSA9PT0gJ28nKSB7CiAgICByZXR1cm4gS0lORwogIH0KICByZXR1cm4gcGllY2VfdHlwZQp9CgovLyBwYXJzZXMgYWxsIG9mIHRoZSBkZWNvcmF0b3JzIG91dCBvZiBhIFNBTiBzdHJpbmcKZnVuY3Rpb24gc3RyaXBwZWRfc2FuKG1vdmUpIHsKICByZXR1cm4gbW92ZS5yZXBsYWNlKC89LywgJycpLnJlcGxhY2UoL1srI10/Wz8hXSokLywgJycpCn0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBVVElMSVRZIEZVTkNUSU9OUwogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KZnVuY3Rpb24gcmFuayhpKSB7CiAgcmV0dXJuIGkgPj4gNAp9CgpmdW5jdGlvbiBmaWxlKGkpIHsKICByZXR1cm4gaSAmIDE1Cn0KCmZ1bmN0aW9uIGFsZ2VicmFpYyhpKSB7CiAgdmFyIGYgPSBmaWxlKGkpLAogICAgciA9IHJhbmsoaSkKICByZXR1cm4gJ2FiY2RlZmdoJy5zdWJzdHJpbmcoZiwgZiArIDEpICsgJzg3NjU0MzIxJy5zdWJzdHJpbmcociwgciArIDEpCn0KCmZ1bmN0aW9uIHN3YXBfY29sb3IoYykgewogIHJldHVybiBjID09PSBXSElURSA/IEJMQUNLIDogV0hJVEUKfQoKZnVuY3Rpb24gaXNfZGlnaXQoYykgewogIHJldHVybiAnMDEyMzQ1Njc4OScuaW5kZXhPZihjKSAhPT0gLTEKfQoKZnVuY3Rpb24gY2xvbmUob2JqKSB7CiAgdmFyIGR1cGUgPSBvYmogaW5zdGFuY2VvZiBBcnJheSA/IFtdIDoge30KCiAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqKSB7CiAgICBpZiAodHlwZW9mIHByb3BlcnR5ID09PSAnb2JqZWN0JykgewogICAgICBkdXBlW3Byb3BlcnR5XSA9IGNsb25lKG9ialtwcm9wZXJ0eV0pCiAgICB9IGVsc2UgewogICAgICBkdXBlW3Byb3BlcnR5XSA9IG9ialtwcm9wZXJ0eV0KICAgIH0KICB9CgogIHJldHVybiBkdXBlCn0KCmZ1bmN0aW9uIHRyaW0oc3RyKSB7CiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCn0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogUFVCTElDIENPTlNUQU5UUwogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgpjb25zdCBCTEFDSyA9ICdiJwpjb25zdCBXSElURSA9ICd3JwoKY29uc3QgRU1QVFkgPSAtMQoKY29uc3QgUEFXTiA9ICdwJwpjb25zdCBLTklHSFQgPSAnbicKY29uc3QgQklTSE9QID0gJ2InCmNvbnN0IFJPT0sgPSAncicKY29uc3QgUVVFRU4gPSAncScKY29uc3QgS0lORyA9ICdrJwoKY29uc3QgU1FVQVJFUyA9IChmdW5jdGlvbiAoKSB7CiAgLyogZnJvbSB0aGUgRUNNQS0yNjIgc3BlYyAoc2VjdGlvbiAxMi42LjQpOgogICAqICJUaGUgbWVjaGFuaWNzIG9mIGVudW1lcmF0aW5nIHRoZSBwcm9wZXJ0aWVzIC4uLiBpcwogICAqIGltcGxlbWVudGF0aW9uIGRlcGVuZGVudCIKICAgKiBzbzogZm9yICh2YXIgc3EgaW4gU1FVQVJFUykgeyBrZXlzLnB1c2goc3EpOyB9IG1pZ2h0IG5vdCBiZQogICAqIG9yZGVyZWQgY29ycmVjdGx5CiAgICovCiAgdmFyIGtleXMgPSBbXQogIGZvciAodmFyIGkgPSBTUVVBUkVfTUFQLmE4OyBpIDw9IFNRVUFSRV9NQVAuaDE7IGkrKykgewogICAgaWYgKGkgJiAweDg4KSB7CiAgICAgIGkgKz0gNwogICAgICBjb250aW51ZQogICAgfQogICAga2V5cy5wdXNoKGFsZ2VicmFpYyhpKSkKICB9CiAgcmV0dXJuIGtleXMKfSkoKQoKY29uc3QgRkxBR1MgPSB7CiAgTk9STUFMOiAnbicsCiAgQ0FQVFVSRTogJ2MnLAogIEJJR19QQVdOOiAnYicsCiAgRVBfQ0FQVFVSRTogJ2UnLAogIFBST01PVElPTjogJ3AnLAogIEtTSURFX0NBU1RMRTogJ2snLAogIFFTSURFX0NBU1RMRTogJ3EnLAp9Cgpjb25zdCBDaGVzcyA9IGZ1bmN0aW9uIChmZW4pIHsKICB2YXIgYm9hcmQgPSBuZXcgQXJyYXkoMTI4KQogIHZhciBraW5ncyA9IHsgdzogRU1QVFksIGI6IEVNUFRZIH0KICB2YXIgdHVybiA9IFdISVRFCiAgdmFyIGNhc3RsaW5nID0geyB3OiAwLCBiOiAwIH0KICB2YXIgZXBfc3F1YXJlID0gRU1QVFkKICB2YXIgaGFsZl9tb3ZlcyA9IDAKICB2YXIgbW92ZV9udW1iZXIgPSAxCiAgdmFyIGhpc3RvcnkgPSBbXQogIHZhciBoZWFkZXIgPSB7fQogIHZhciBjb21tZW50cyA9IHt9CgogIC8qIGlmIHRoZSB1c2VyIHBhc3NlcyBpbiBhIGZlbiBzdHJpbmcsIGxvYWQgaXQsIGVsc2UgZGVmYXVsdCB0bwogICAqIHN0YXJ0aW5nIHBvc2l0aW9uCiAgICovCiAgaWYgKHR5cGVvZiBmZW4gPT09ICd1bmRlZmluZWQnKSB7CiAgICBsb2FkKERFRkFVTFRfUE9TSVRJT04pCiAgfSBlbHNlIHsKICAgIGxvYWQoZmVuKQogIH0KCiAgZnVuY3Rpb24gY2xlYXIoa2VlcF9oZWFkZXJzKSB7CiAgICBpZiAodHlwZW9mIGtlZXBfaGVhZGVycyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAga2VlcF9oZWFkZXJzID0gZmFsc2UKICAgIH0KCiAgICBib2FyZCA9IG5ldyBBcnJheSgxMjgpCiAgICBraW5ncyA9IHsgdzogRU1QVFksIGI6IEVNUFRZIH0KICAgIHR1cm4gPSBXSElURQogICAgY2FzdGxpbmcgPSB7IHc6IDAsIGI6IDAgfQogICAgZXBfc3F1YXJlID0gRU1QVFkKICAgIGhhbGZfbW92ZXMgPSAwCiAgICBtb3ZlX251bWJlciA9IDEKICAgIGhpc3RvcnkgPSBbXQogICAgaWYgKCFrZWVwX2hlYWRlcnMpIGhlYWRlciA9IHt9CiAgICBjb21tZW50cyA9IHt9CiAgICB1cGRhdGVfc2V0dXAoZ2VuZXJhdGVfZmVuKCkpCiAgfQoKICBmdW5jdGlvbiBwcnVuZV9jb21tZW50cygpIHsKICAgIHZhciByZXZlcnNlZF9oaXN0b3J5ID0gW10KICAgIHZhciBjdXJyZW50X2NvbW1lbnRzID0ge30KICAgIHZhciBjb3B5X2NvbW1lbnQgPSBmdW5jdGlvbiAoZmVuKSB7CiAgICAgIGlmIChmZW4gaW4gY29tbWVudHMpIHsKICAgICAgICBjdXJyZW50X2NvbW1lbnRzW2Zlbl0gPSBjb21tZW50c1tmZW5dCiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChoaXN0b3J5Lmxlbmd0aCA+IDApIHsKICAgICAgcmV2ZXJzZWRfaGlzdG9yeS5wdXNoKHVuZG9fbW92ZSgpKQogICAgfQogICAgY29weV9jb21tZW50KGdlbmVyYXRlX2ZlbigpKQogICAgd2hpbGUgKHJldmVyc2VkX2hpc3RvcnkubGVuZ3RoID4gMCkgewogICAgICBtYWtlX21vdmUocmV2ZXJzZWRfaGlzdG9yeS5wb3AoKSkKICAgICAgY29weV9jb21tZW50KGdlbmVyYXRlX2ZlbigpKQogICAgfQogICAgY29tbWVudHMgPSBjdXJyZW50X2NvbW1lbnRzCiAgfQoKICBmdW5jdGlvbiByZXNldCgpIHsKICAgIGxvYWQoREVGQVVMVF9QT1NJVElPTikKICB9CgogIGZ1bmN0aW9uIGxvYWQoZmVuLCBrZWVwX2hlYWRlcnMpIHsKICAgIGlmICh0eXBlb2Yga2VlcF9oZWFkZXJzID09PSAndW5kZWZpbmVkJykgewogICAgICBrZWVwX2hlYWRlcnMgPSBmYWxzZQogICAgfQoKICAgIHZhciB0b2tlbnMgPSBmZW4uc3BsaXQoL1xzKy8pCiAgICB2YXIgcG9zaXRpb24gPSB0b2tlbnNbMF0KICAgIHZhciBzcXVhcmUgPSAwCgogICAgaWYgKCF2YWxpZGF0ZV9mZW4oZmVuKS52YWxpZCkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KCiAgICBjbGVhcihrZWVwX2hlYWRlcnMpCgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3NpdGlvbi5sZW5ndGg7IGkrKykgewogICAgICB2YXIgcGllY2UgPSBwb3NpdGlvbi5jaGFyQXQoaSkKCiAgICAgIGlmIChwaWVjZSA9PT0gJy8nKSB7CiAgICAgICAgc3F1YXJlICs9IDgKICAgICAgfSBlbHNlIGlmIChpc19kaWdpdChwaWVjZSkpIHsKICAgICAgICBzcXVhcmUgKz0gcGFyc2VJbnQocGllY2UsIDEwKQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjb2xvciA9IHBpZWNlIDwgJ2EnID8gV0hJVEUgOiBCTEFDSwogICAgICAgIHB1dCh7IHR5cGU6IHBpZWNlLnRvTG93ZXJDYXNlKCksIGNvbG9yOiBjb2xvciB9LCBhbGdlYnJhaWMoc3F1YXJlKSkKICAgICAgICBzcXVhcmUrKwogICAgICB9CiAgICB9CgogICAgdHVybiA9IHRva2Vuc1sxXQoKICAgIGlmICh0b2tlbnNbMl0uaW5kZXhPZignSycpID4gLTEpIHsKICAgICAgY2FzdGxpbmcudyB8PSBCSVRTLktTSURFX0NBU1RMRQogICAgfQogICAgaWYgKHRva2Vuc1syXS5pbmRleE9mKCdRJykgPiAtMSkgewogICAgICBjYXN0bGluZy53IHw9IEJJVFMuUVNJREVfQ0FTVExFCiAgICB9CiAgICBpZiAodG9rZW5zWzJdLmluZGV4T2YoJ2snKSA+IC0xKSB7CiAgICAgIGNhc3RsaW5nLmIgfD0gQklUUy5LU0lERV9DQVNUTEUKICAgIH0KICAgIGlmICh0b2tlbnNbMl0uaW5kZXhPZigncScpID4gLTEpIHsKICAgICAgY2FzdGxpbmcuYiB8PSBCSVRTLlFTSURFX0NBU1RMRQogICAgfQoKICAgIGVwX3NxdWFyZSA9IHRva2Vuc1szXSA9PT0gJy0nID8gRU1QVFkgOiBTUVVBUkVfTUFQW3Rva2Vuc1szXV0KICAgIGhhbGZfbW92ZXMgPSBwYXJzZUludCh0b2tlbnNbNF0sIDEwKQogICAgbW92ZV9udW1iZXIgPSBwYXJzZUludCh0b2tlbnNbNV0sIDEwKQoKICAgIHVwZGF0ZV9zZXR1cChnZW5lcmF0ZV9mZW4oKSkKCiAgICByZXR1cm4gdHJ1ZQogIH0KCiAgLyogVE9ETzogdGhpcyBmdW5jdGlvbiBpcyBwcmV0dHkgbXVjaCBjcmFwIC0gaXQgdmFsaWRhdGVzIHN0cnVjdHVyZSBidXQKICAgKiBjb21wbGV0ZWx5IGlnbm9yZXMgY29udGVudCAoZS5nLiBkb2Vzbid0IHZlcmlmeSB0aGF0IGVhY2ggc2lkZSBoYXMgYSBraW5nKQogICAqIC4uLiB3ZSBzaG91bGQgcmV3cml0ZSB0aGlzLCBhbmQgZGl0Y2ggdGhlIHNpbGx5IGVycm9yX251bWJlciBmaWVsZCB3aGlsZQogICAqIHdlJ3JlIGF0IGl0CiAgICovCiAgZnVuY3Rpb24gdmFsaWRhdGVfZmVuKGZlbikgewogICAgdmFyIGVycm9ycyA9IHsKICAgICAgMDogJ05vIGVycm9ycy4nLAogICAgICAxOiAnRkVOIHN0cmluZyBtdXN0IGNvbnRhaW4gc2l4IHNwYWNlLWRlbGltaXRlZCBmaWVsZHMuJywKICAgICAgMjogJzZ0aCBmaWVsZCAobW92ZSBudW1iZXIpIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLicsCiAgICAgIDM6ICc1dGggZmllbGQgKGhhbGYgbW92ZSBjb3VudGVyKSBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIGludGVnZXIuJywKICAgICAgNDogJzR0aCBmaWVsZCAoZW4tcGFzc2FudCBzcXVhcmUpIGlzIGludmFsaWQuJywKICAgICAgNTogJzNyZCBmaWVsZCAoY2FzdGxpbmcgYXZhaWxhYmlsaXR5KSBpcyBpbnZhbGlkLicsCiAgICAgIDY6ICcybmQgZmllbGQgKHNpZGUgdG8gbW92ZSkgaXMgaW52YWxpZC4nLAogICAgICA3OiAiMXN0IGZpZWxkIChwaWVjZSBwb3NpdGlvbnMpIGRvZXMgbm90IGNvbnRhaW4gOCAnLyctZGVsaW1pdGVkIHJvd3MuIiwKICAgICAgODogJzFzdCBmaWVsZCAocGllY2UgcG9zaXRpb25zKSBpcyBpbnZhbGlkIFtjb25zZWN1dGl2ZSBudW1iZXJzXS4nLAogICAgICA5OiAnMXN0IGZpZWxkIChwaWVjZSBwb3NpdGlvbnMpIGlzIGludmFsaWQgW2ludmFsaWQgcGllY2VdLicsCiAgICAgIDEwOiAnMXN0IGZpZWxkIChwaWVjZSBwb3NpdGlvbnMpIGlzIGludmFsaWQgW3JvdyB0b28gbGFyZ2VdLicsCiAgICAgIDExOiAnSWxsZWdhbCBlbi1wYXNzYW50IHNxdWFyZScsCiAgICB9CgogICAgLyogMXN0IGNyaXRlcmlvbjogNiBzcGFjZS1zZXBlcmF0ZWQgZmllbGRzPyAqLwogICAgdmFyIHRva2VucyA9IGZlbi5zcGxpdCgvXHMrLykKICAgIGlmICh0b2tlbnMubGVuZ3RoICE9PSA2KSB7CiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JfbnVtYmVyOiAxLCBlcnJvcjogZXJyb3JzWzFdIH0KICAgIH0KCiAgICAvKiAybmQgY3JpdGVyaW9uOiBtb3ZlIG51bWJlciBmaWVsZCBpcyBhIGludGVnZXIgdmFsdWUgPiAwPyAqLwogICAgaWYgKGlzTmFOKHBhcnNlSW50KHRva2Vuc1s1XSkpIHx8IHBhcnNlSW50KHRva2Vuc1s1XSwgMTApIDw9IDApIHsKICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcl9udW1iZXI6IDIsIGVycm9yOiBlcnJvcnNbMl0gfQogICAgfQoKICAgIC8qIDNyZCBjcml0ZXJpb246IGhhbGYgbW92ZSBjb3VudGVyIGlzIGFuIGludGVnZXIgPj0gMD8gKi8KICAgIGlmIChpc05hTihwYXJzZUludCh0b2tlbnNbNF0pKSB8fCBwYXJzZUludCh0b2tlbnNbNF0sIDEwKSA8IDApIHsKICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcl9udW1iZXI6IDMsIGVycm9yOiBlcnJvcnNbM10gfQogICAgfQoKICAgIC8qIDR0aCBjcml0ZXJpb246IDR0aCBmaWVsZCBpcyBhIHZhbGlkIGUucC4tc3RyaW5nPyAqLwogICAgaWYgKCEvXigtfFthYmNkZWZnaF1bMzZdKSQvLnRlc3QodG9rZW5zWzNdKSkgewogICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yX251bWJlcjogNCwgZXJyb3I6IGVycm9yc1s0XSB9CiAgICB9CgogICAgLyogNXRoIGNyaXRlcmlvbjogM3RoIGZpZWxkIGlzIGEgdmFsaWQgY2FzdGxlLXN0cmluZz8gKi8KICAgIGlmICghL14oS1E/az9xP3xRaz9xP3xrcT98cXwtKSQvLnRlc3QodG9rZW5zWzJdKSkgewogICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yX251bWJlcjogNSwgZXJyb3I6IGVycm9yc1s1XSB9CiAgICB9CgogICAgLyogNnRoIGNyaXRlcmlvbjogMm5kIGZpZWxkIGlzICJ3IiAod2hpdGUpIG9yICJiIiAoYmxhY2spPyAqLwogICAgaWYgKCEvXih3fGIpJC8udGVzdCh0b2tlbnNbMV0pKSB7CiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JfbnVtYmVyOiA2LCBlcnJvcjogZXJyb3JzWzZdIH0KICAgIH0KCiAgICAvKiA3dGggY3JpdGVyaW9uOiAxc3QgZmllbGQgY29udGFpbnMgOCByb3dzPyAqLwogICAgdmFyIHJvd3MgPSB0b2tlbnNbMF0uc3BsaXQoJy8nKQogICAgaWYgKHJvd3MubGVuZ3RoICE9PSA4KSB7CiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JfbnVtYmVyOiA3LCBlcnJvcjogZXJyb3JzWzddIH0KICAgIH0KCiAgICAvKiA4dGggY3JpdGVyaW9uOiBldmVyeSByb3cgaXMgdmFsaWQ/ICovCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHsKICAgICAgLyogY2hlY2sgZm9yIHJpZ2h0IHN1bSBvZiBmaWVsZHMgQU5EIG5vdCB0d28gbnVtYmVycyBpbiBzdWNjZXNzaW9uICovCiAgICAgIHZhciBzdW1fZmllbGRzID0gMAogICAgICB2YXIgcHJldmlvdXNfd2FzX251bWJlciA9IGZhbHNlCgogICAgICBmb3IgKHZhciBrID0gMDsgayA8IHJvd3NbaV0ubGVuZ3RoOyBrKyspIHsKICAgICAgICBpZiAoIWlzTmFOKHJvd3NbaV1ba10pKSB7CiAgICAgICAgICBpZiAocHJldmlvdXNfd2FzX251bWJlcikgewogICAgICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yX251bWJlcjogOCwgZXJyb3I6IGVycm9yc1s4XSB9CiAgICAgICAgICB9CiAgICAgICAgICBzdW1fZmllbGRzICs9IHBhcnNlSW50KHJvd3NbaV1ba10sIDEwKQogICAgICAgICAgcHJldmlvdXNfd2FzX251bWJlciA9IHRydWUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCEvXltwcm5icWtQUk5CUUtdJC8udGVzdChyb3dzW2ldW2tdKSkgewogICAgICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yX251bWJlcjogOSwgZXJyb3I6IGVycm9yc1s5XSB9CiAgICAgICAgICB9CiAgICAgICAgICBzdW1fZmllbGRzICs9IDEKICAgICAgICAgIHByZXZpb3VzX3dhc19udW1iZXIgPSBmYWxzZQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3VtX2ZpZWxkcyAhPT0gOCkgewogICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JfbnVtYmVyOiAxMCwgZXJyb3I6IGVycm9yc1sxMF0gfQogICAgICB9CiAgICB9CgogICAgaWYgKAogICAgICAodG9rZW5zWzNdWzFdID09ICczJyAmJiB0b2tlbnNbMV0gPT0gJ3cnKSB8fAogICAgICAodG9rZW5zWzNdWzFdID09ICc2JyAmJiB0b2tlbnNbMV0gPT0gJ2InKQogICAgKSB7CiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JfbnVtYmVyOiAxMSwgZXJyb3I6IGVycm9yc1sxMV0gfQogICAgfQoKICAgIC8qIGV2ZXJ5dGhpbmcncyBva2F5ISAqLwogICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIGVycm9yX251bWJlcjogMCwgZXJyb3I6IGVycm9yc1swXSB9CiAgfQoKICBmdW5jdGlvbiBnZW5lcmF0ZV9mZW4oKSB7CiAgICB2YXIgZW1wdHkgPSAwCiAgICB2YXIgZmVuID0gJycKCiAgICBmb3IgKHZhciBpID0gU1FVQVJFX01BUC5hODsgaSA8PSBTUVVBUkVfTUFQLmgxOyBpKyspIHsKICAgICAgaWYgKGJvYXJkW2ldID09IG51bGwpIHsKICAgICAgICBlbXB0eSsrCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGVtcHR5ID4gMCkgewogICAgICAgICAgZmVuICs9IGVtcHR5CiAgICAgICAgICBlbXB0eSA9IDAKICAgICAgICB9CiAgICAgICAgdmFyIGNvbG9yID0gYm9hcmRbaV0uY29sb3IKICAgICAgICB2YXIgcGllY2UgPSBib2FyZFtpXS50eXBlCgogICAgICAgIGZlbiArPSBjb2xvciA9PT0gV0hJVEUgPyBwaWVjZS50b1VwcGVyQ2FzZSgpIDogcGllY2UudG9Mb3dlckNhc2UoKQogICAgICB9CgogICAgICBpZiAoKGkgKyAxKSAmIDB4ODgpIHsKICAgICAgICBpZiAoZW1wdHkgPiAwKSB7CiAgICAgICAgICBmZW4gKz0gZW1wdHkKICAgICAgICB9CgogICAgICAgIGlmIChpICE9PSBTUVVBUkVfTUFQLmgxKSB7CiAgICAgICAgICBmZW4gKz0gJy8nCiAgICAgICAgfQoKICAgICAgICBlbXB0eSA9IDAKICAgICAgICBpICs9IDgKICAgICAgfQogICAgfQoKICAgIHZhciBjZmxhZ3MgPSAnJwogICAgaWYgKGNhc3RsaW5nW1dISVRFXSAmIEJJVFMuS1NJREVfQ0FTVExFKSB7CiAgICAgIGNmbGFncyArPSAnSycKICAgIH0KICAgIGlmIChjYXN0bGluZ1tXSElURV0gJiBCSVRTLlFTSURFX0NBU1RMRSkgewogICAgICBjZmxhZ3MgKz0gJ1EnCiAgICB9CiAgICBpZiAoY2FzdGxpbmdbQkxBQ0tdICYgQklUUy5LU0lERV9DQVNUTEUpIHsKICAgICAgY2ZsYWdzICs9ICdrJwogICAgfQogICAgaWYgKGNhc3RsaW5nW0JMQUNLXSAmIEJJVFMuUVNJREVfQ0FTVExFKSB7CiAgICAgIGNmbGFncyArPSAncScKICAgIH0KCiAgICAvKiBkbyB3ZSBoYXZlIGFuIGVtcHR5IGNhc3RsaW5nIGZsYWc/ICovCiAgICBjZmxhZ3MgPSBjZmxhZ3MgfHwgJy0nCiAgICB2YXIgZXBmbGFncyA9IGVwX3NxdWFyZSA9PT0gRU1QVFkgPyAnLScgOiBhbGdlYnJhaWMoZXBfc3F1YXJlKQoKICAgIHJldHVybiBbZmVuLCB0dXJuLCBjZmxhZ3MsIGVwZmxhZ3MsIGhhbGZfbW92ZXMsIG1vdmVfbnVtYmVyXS5qb2luKCcgJykKICB9CgogIGZ1bmN0aW9uIHNldF9oZWFkZXIoYXJncykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIGlmICh0eXBlb2YgYXJnc1tpXSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGFyZ3NbaSArIDFdID09PSAnc3RyaW5nJykgewogICAgICAgIGhlYWRlclthcmdzW2ldXSA9IGFyZ3NbaSArIDFdCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBoZWFkZXIKICB9CgogIC8qIGNhbGxlZCB3aGVuIHRoZSBpbml0aWFsIGJvYXJkIHNldHVwIGlzIGNoYW5nZWQgd2l0aCBwdXQoKSBvciByZW1vdmUoKS4KICAgKiBtb2RpZmllcyB0aGUgU2V0VXAgYW5kIEZFTiBwcm9wZXJ0aWVzIG9mIHRoZSBoZWFkZXIgb2JqZWN0LiAgaWYgdGhlIEZFTiBpcwogICAqIGVxdWFsIHRvIHRoZSBkZWZhdWx0IHBvc2l0aW9uLCB0aGUgU2V0VXAgYW5kIEZFTiBhcmUgZGVsZXRlZAogICAqIHRoZSBzZXR1cCBpcyBvbmx5IHVwZGF0ZWQgaWYgaGlzdG9yeS5sZW5ndGggaXMgemVybywgaWUgbW92ZXMgaGF2ZW4ndCBiZWVuCiAgICogbWFkZS4KICAgKi8KICBmdW5jdGlvbiB1cGRhdGVfc2V0dXAoZmVuKSB7CiAgICBpZiAoaGlzdG9yeS5sZW5ndGggPiAwKSByZXR1cm4KCiAgICBpZiAoZmVuICE9PSBERUZBVUxUX1BPU0lUSU9OKSB7CiAgICAgIGhlYWRlclsnU2V0VXAnXSA9ICcxJwogICAgICBoZWFkZXJbJ0ZFTiddID0gZmVuCiAgICB9IGVsc2UgewogICAgICBkZWxldGUgaGVhZGVyWydTZXRVcCddCiAgICAgIGRlbGV0ZSBoZWFkZXJbJ0ZFTiddCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXQoc3F1YXJlKSB7CiAgICB2YXIgcGllY2UgPSBib2FyZFtTUVVBUkVfTUFQW3NxdWFyZV1dCiAgICByZXR1cm4gcGllY2UgPyB7IHR5cGU6IHBpZWNlLnR5cGUsIGNvbG9yOiBwaWVjZS5jb2xvciB9IDogbnVsbAogIH0KCiAgZnVuY3Rpb24gcHV0KHBpZWNlLCBzcXVhcmUpIHsKICAgIC8qIGNoZWNrIGZvciB2YWxpZCBwaWVjZSBvYmplY3QgKi8KICAgIGlmICghKCd0eXBlJyBpbiBwaWVjZSAmJiAnY29sb3InIGluIHBpZWNlKSkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KCiAgICAvKiBjaGVjayBmb3IgcGllY2UgKi8KICAgIGlmIChTWU1CT0xTLmluZGV4T2YocGllY2UudHlwZS50b0xvd2VyQ2FzZSgpKSA9PT0gLTEpIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CgogICAgLyogY2hlY2sgZm9yIHZhbGlkIHNxdWFyZSAqLwogICAgaWYgKCEoc3F1YXJlIGluIFNRVUFSRV9NQVApKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQoKICAgIHZhciBzcSA9IFNRVUFSRV9NQVBbc3F1YXJlXQoKICAgIC8qIGRvbid0IGxldCB0aGUgdXNlciBwbGFjZSBtb3JlIHRoYW4gb25lIGtpbmcgKi8KICAgIGlmICgKICAgICAgcGllY2UudHlwZSA9PSBLSU5HICYmCiAgICAgICEoa2luZ3NbcGllY2UuY29sb3JdID09IEVNUFRZIHx8IGtpbmdzW3BpZWNlLmNvbG9yXSA9PSBzcSkKICAgICkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KCiAgICBib2FyZFtzcV0gPSB7IHR5cGU6IHBpZWNlLnR5cGUsIGNvbG9yOiBwaWVjZS5jb2xvciB9CiAgICBpZiAocGllY2UudHlwZSA9PT0gS0lORykgewogICAgICBraW5nc1twaWVjZS5jb2xvcl0gPSBzcQogICAgfQoKICAgIHVwZGF0ZV9zZXR1cChnZW5lcmF0ZV9mZW4oKSkKCiAgICByZXR1cm4gdHJ1ZQogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlKHNxdWFyZSkgewogICAgdmFyIHBpZWNlID0gZ2V0KHNxdWFyZSkKICAgIGJvYXJkW1NRVUFSRV9NQVBbc3F1YXJlXV0gPSBudWxsCiAgICBpZiAocGllY2UgJiYgcGllY2UudHlwZSA9PT0gS0lORykgewogICAgICBraW5nc1twaWVjZS5jb2xvcl0gPSBFTVBUWQogICAgfQoKICAgIHVwZGF0ZV9zZXR1cChnZW5lcmF0ZV9mZW4oKSkKCiAgICByZXR1cm4gcGllY2UKICB9CgogIGZ1bmN0aW9uIGJ1aWxkX21vdmUoYm9hcmQsIGZyb20sIHRvLCBmbGFncywgcHJvbW90aW9uKSB7CiAgICB2YXIgbW92ZSA9IHsKICAgICAgY29sb3I6IHR1cm4sCiAgICAgIGZyb206IGZyb20sCiAgICAgIHRvOiB0bywKICAgICAgZmxhZ3M6IGZsYWdzLAogICAgICBwaWVjZTogYm9hcmRbZnJvbV0udHlwZSwKICAgIH0KCiAgICBpZiAocHJvbW90aW9uKSB7CiAgICAgIG1vdmUuZmxhZ3MgfD0gQklUUy5QUk9NT1RJT04KICAgICAgbW92ZS5wcm9tb3Rpb24gPSBwcm9tb3Rpb24KICAgIH0KCiAgICBpZiAoYm9hcmRbdG9dKSB7CiAgICAgIG1vdmUuY2FwdHVyZWQgPSBib2FyZFt0b10udHlwZQogICAgfSBlbHNlIGlmIChmbGFncyAmIEJJVFMuRVBfQ0FQVFVSRSkgewogICAgICBtb3ZlLmNhcHR1cmVkID0gUEFXTgogICAgfQogICAgcmV0dXJuIG1vdmUKICB9CgogIGZ1bmN0aW9uIGdlbmVyYXRlX21vdmVzKG9wdGlvbnMpIHsKICAgIGZ1bmN0aW9uIGFkZF9tb3ZlKGJvYXJkLCBtb3ZlcywgZnJvbSwgdG8sIGZsYWdzKSB7CiAgICAgIC8qIGlmIHBhd24gcHJvbW90aW9uICovCiAgICAgIGlmICgKICAgICAgICBib2FyZFtmcm9tXS50eXBlID09PSBQQVdOICYmCiAgICAgICAgKHJhbmsodG8pID09PSBSQU5LXzggfHwgcmFuayh0bykgPT09IFJBTktfMSkKICAgICAgKSB7CiAgICAgICAgdmFyIHBpZWNlcyA9IFtRVUVFTiwgUk9PSywgQklTSE9QLCBLTklHSFRdCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBpZWNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgbW92ZXMucHVzaChidWlsZF9tb3ZlKGJvYXJkLCBmcm9tLCB0bywgZmxhZ3MsIHBpZWNlc1tpXSkpCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG1vdmVzLnB1c2goYnVpbGRfbW92ZShib2FyZCwgZnJvbSwgdG8sIGZsYWdzKSkKICAgICAgfQogICAgfQoKICAgIHZhciBtb3ZlcyA9IFtdCiAgICB2YXIgdXMgPSB0dXJuCiAgICB2YXIgdGhlbSA9IHN3YXBfY29sb3IodXMpCiAgICB2YXIgc2Vjb25kX3JhbmsgPSB7IGI6IFJBTktfNywgdzogUkFOS18yIH0KCiAgICB2YXIgZmlyc3Rfc3EgPSBTUVVBUkVfTUFQLmE4CiAgICB2YXIgbGFzdF9zcSA9IFNRVUFSRV9NQVAuaDEKICAgIHZhciBzaW5nbGVfc3F1YXJlID0gZmFsc2UKCiAgICAvKiBkbyB3ZSB3YW50IGxlZ2FsIG1vdmVzPyAqLwogICAgdmFyIGxlZ2FsID0KICAgICAgdHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmICdsZWdhbCcgaW4gb3B0aW9ucwogICAgICAgID8gb3B0aW9ucy5sZWdhbAogICAgICAgIDogdHJ1ZQoKICAgIHZhciBwaWVjZV90eXBlID0KICAgICAgdHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICdwaWVjZScgaW4gb3B0aW9ucyAmJgogICAgICB0eXBlb2Ygb3B0aW9ucy5waWVjZSA9PT0gJ3N0cmluZycKICAgICAgICA/IG9wdGlvbnMucGllY2UudG9Mb3dlckNhc2UoKQogICAgICAgIDogdHJ1ZQoKICAgIC8qIGFyZSB3ZSBnZW5lcmF0aW5nIG1vdmVzIGZvciBhIHNpbmdsZSBzcXVhcmU/ICovCiAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmICdzcXVhcmUnIGluIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMuc3F1YXJlIGluIFNRVUFSRV9NQVApIHsKICAgICAgICBmaXJzdF9zcSA9IGxhc3Rfc3EgPSBTUVVBUkVfTUFQW29wdGlvbnMuc3F1YXJlXQogICAgICAgIHNpbmdsZV9zcXVhcmUgPSB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogaW52YWxpZCBzcXVhcmUgKi8KICAgICAgICByZXR1cm4gW10KICAgICAgfQogICAgfQoKICAgIGZvciAodmFyIGkgPSBmaXJzdF9zcTsgaSA8PSBsYXN0X3NxOyBpKyspIHsKICAgICAgLyogZGlkIHdlIHJ1biBvZmYgdGhlIGVuZCBvZiB0aGUgYm9hcmQgKi8KICAgICAgaWYgKGkgJiAweDg4KSB7CiAgICAgICAgaSArPSA3CiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgdmFyIHBpZWNlID0gYm9hcmRbaV0KICAgICAgaWYgKHBpZWNlID09IG51bGwgfHwgcGllY2UuY29sb3IgIT09IHVzKSB7CiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgaWYgKHBpZWNlLnR5cGUgPT09IFBBV04gJiYgKHBpZWNlX3R5cGUgPT09IHRydWUgfHwgcGllY2VfdHlwZSA9PT0gUEFXTikpIHsKICAgICAgICAvKiBzaW5nbGUgc3F1YXJlLCBub24tY2FwdHVyaW5nICovCiAgICAgICAgdmFyIHNxdWFyZSA9IGkgKyBQQVdOX09GRlNFVFNbdXNdWzBdCiAgICAgICAgaWYgKGJvYXJkW3NxdWFyZV0gPT0gbnVsbCkgewogICAgICAgICAgYWRkX21vdmUoYm9hcmQsIG1vdmVzLCBpLCBzcXVhcmUsIEJJVFMuTk9STUFMKQoKICAgICAgICAgIC8qIGRvdWJsZSBzcXVhcmUgKi8KICAgICAgICAgIHZhciBzcXVhcmUgPSBpICsgUEFXTl9PRkZTRVRTW3VzXVsxXQogICAgICAgICAgaWYgKHNlY29uZF9yYW5rW3VzXSA9PT0gcmFuayhpKSAmJiBib2FyZFtzcXVhcmVdID09IG51bGwpIHsKICAgICAgICAgICAgYWRkX21vdmUoYm9hcmQsIG1vdmVzLCBpLCBzcXVhcmUsIEJJVFMuQklHX1BBV04pCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKiBwYXduIGNhcHR1cmVzICovCiAgICAgICAgZm9yIChqID0gMjsgaiA8IDQ7IGorKykgewogICAgICAgICAgdmFyIHNxdWFyZSA9IGkgKyBQQVdOX09GRlNFVFNbdXNdW2pdCiAgICAgICAgICBpZiAoc3F1YXJlICYgMHg4OCkgY29udGludWUKCiAgICAgICAgICBpZiAoYm9hcmRbc3F1YXJlXSAhPSBudWxsICYmIGJvYXJkW3NxdWFyZV0uY29sb3IgPT09IHRoZW0pIHsKICAgICAgICAgICAgYWRkX21vdmUoYm9hcmQsIG1vdmVzLCBpLCBzcXVhcmUsIEJJVFMuQ0FQVFVSRSkKICAgICAgICAgIH0gZWxzZSBpZiAoc3F1YXJlID09PSBlcF9zcXVhcmUpIHsKICAgICAgICAgICAgYWRkX21vdmUoYm9hcmQsIG1vdmVzLCBpLCBlcF9zcXVhcmUsIEJJVFMuRVBfQ0FQVFVSRSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGllY2VfdHlwZSA9PT0gdHJ1ZSB8fCBwaWVjZV90eXBlID09PSBwaWVjZS50eXBlKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbiA9IFBJRUNFX09GRlNFVFNbcGllY2UudHlwZV0ubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICAgIHZhciBvZmZzZXQgPSBQSUVDRV9PRkZTRVRTW3BpZWNlLnR5cGVdW2pdCiAgICAgICAgICB2YXIgc3F1YXJlID0gaQoKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIHNxdWFyZSArPSBvZmZzZXQKICAgICAgICAgICAgaWYgKHNxdWFyZSAmIDB4ODgpIGJyZWFrCgogICAgICAgICAgICBpZiAoYm9hcmRbc3F1YXJlXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgYWRkX21vdmUoYm9hcmQsIG1vdmVzLCBpLCBzcXVhcmUsIEJJVFMuTk9STUFMKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChib2FyZFtzcXVhcmVdLmNvbG9yID09PSB1cykgYnJlYWsKICAgICAgICAgICAgICBhZGRfbW92ZShib2FyZCwgbW92ZXMsIGksIHNxdWFyZSwgQklUUy5DQVBUVVJFKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIGJyZWFrLCBpZiBrbmlnaHQgb3Iga2luZyAqLwogICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ24nIHx8IHBpZWNlLnR5cGUgPT09ICdrJykgYnJlYWsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvKiBjaGVjayBmb3IgY2FzdGxpbmcgaWY6IGEpIHdlJ3JlIGdlbmVyYXRpbmcgYWxsIG1vdmVzLCBvciBiKSB3ZSdyZSBkb2luZwogICAgICogc2luZ2xlIHNxdWFyZSBtb3ZlIGdlbmVyYXRpb24gb24gdGhlIGtpbmcncyBzcXVhcmUKICAgICAqLwogICAgaWYgKHBpZWNlX3R5cGUgPT09IHRydWUgfHwgcGllY2VfdHlwZSA9PT0gS0lORykgewogICAgICBpZiAoIXNpbmdsZV9zcXVhcmUgfHwgbGFzdF9zcSA9PT0ga2luZ3NbdXNdKSB7CiAgICAgICAgLyoga2luZy1zaWRlIGNhc3RsaW5nICovCiAgICAgICAgaWYgKGNhc3RsaW5nW3VzXSAmIEJJVFMuS1NJREVfQ0FTVExFKSB7CiAgICAgICAgICB2YXIgY2FzdGxpbmdfZnJvbSA9IGtpbmdzW3VzXQogICAgICAgICAgdmFyIGNhc3RsaW5nX3RvID0gY2FzdGxpbmdfZnJvbSArIDIKCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb20gKyAxXSA9PSBudWxsICYmCiAgICAgICAgICAgIGJvYXJkW2Nhc3RsaW5nX3RvXSA9PSBudWxsICYmCiAgICAgICAgICAgICFhdHRhY2tlZCh0aGVtLCBraW5nc1t1c10pICYmCiAgICAgICAgICAgICFhdHRhY2tlZCh0aGVtLCBjYXN0bGluZ19mcm9tICsgMSkgJiYKICAgICAgICAgICAgIWF0dGFja2VkKHRoZW0sIGNhc3RsaW5nX3RvKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIGFkZF9tb3ZlKGJvYXJkLCBtb3Zlcywga2luZ3NbdXNdLCBjYXN0bGluZ190bywgQklUUy5LU0lERV9DQVNUTEUpCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKiBxdWVlbi1zaWRlIGNhc3RsaW5nICovCiAgICAgICAgaWYgKGNhc3RsaW5nW3VzXSAmIEJJVFMuUVNJREVfQ0FTVExFKSB7CiAgICAgICAgICB2YXIgY2FzdGxpbmdfZnJvbSA9IGtpbmdzW3VzXQogICAgICAgICAgdmFyIGNhc3RsaW5nX3RvID0gY2FzdGxpbmdfZnJvbSAtIDIKCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb20gLSAxXSA9PSBudWxsICYmCiAgICAgICAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb20gLSAyXSA9PSBudWxsICYmCiAgICAgICAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb20gLSAzXSA9PSBudWxsICYmCiAgICAgICAgICAgICFhdHRhY2tlZCh0aGVtLCBraW5nc1t1c10pICYmCiAgICAgICAgICAgICFhdHRhY2tlZCh0aGVtLCBjYXN0bGluZ19mcm9tIC0gMSkgJiYKICAgICAgICAgICAgIWF0dGFja2VkKHRoZW0sIGNhc3RsaW5nX3RvKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIGFkZF9tb3ZlKGJvYXJkLCBtb3Zlcywga2luZ3NbdXNdLCBjYXN0bGluZ190bywgQklUUy5RU0lERV9DQVNUTEUpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLyogcmV0dXJuIGFsbCBwc2V1ZG8tbGVnYWwgbW92ZXMgKHRoaXMgaW5jbHVkZXMgbW92ZXMgdGhhdCBhbGxvdyB0aGUga2luZwogICAgICogdG8gYmUgY2FwdHVyZWQpCiAgICAgKi8KICAgIGlmICghbGVnYWwpIHsKICAgICAgcmV0dXJuIG1vdmVzCiAgICB9CgogICAgLyogZmlsdGVyIG91dCBpbGxlZ2FsIG1vdmVzICovCiAgICB2YXIgbGVnYWxfbW92ZXMgPSBbXQogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG1vdmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIG1ha2VfbW92ZShtb3Zlc1tpXSkKICAgICAgaWYgKCFraW5nX2F0dGFja2VkKHVzKSkgewogICAgICAgIGxlZ2FsX21vdmVzLnB1c2gobW92ZXNbaV0pCiAgICAgIH0KICAgICAgdW5kb19tb3ZlKCkKICAgIH0KCiAgICByZXR1cm4gbGVnYWxfbW92ZXMKICB9CgogIC8qIGNvbnZlcnQgYSBtb3ZlIGZyb20gMHg4OCBjb29yZGluYXRlcyB0byBTdGFuZGFyZCBBbGdlYnJhaWMgTm90YXRpb24KICAgKiAoU0FOKQogICAqCiAgICogQHBhcmFtIHtib29sZWFufSBzbG9wcHkgVXNlIHRoZSBzbG9wcHkgU0FOIGdlbmVyYXRvciB0byB3b3JrIGFyb3VuZCBvdmVyCiAgICogZGlzYW1iaWd1YXRpb24gYnVncyBpbiBGcml0eiBhbmQgQ2hlc3NiYXNlLiAgU2VlIGJlbG93OgogICAqCiAgICogcjFicWtibnIvcHBwMnBwcC8ybjUvMUIxcFAzLzRQMy84L1BQUFAyUFAvUk5CUUsxTlIgYiBLUWtxIC0gMiA0CiAgICogNC4gLi4uIE5nZTcgaXMgb3Zlcmx5IGRpc2FtYmlndWF0ZWQgYmVjYXVzZSB0aGUga25pZ2h0IG9uIGM2IGlzIHBpbm5lZAogICAqIDQuIC4uLiBOZTcgaXMgdGVjaG5pY2FsbHkgdGhlIHZhbGlkIFNBTgogICAqLwogIGZ1bmN0aW9uIG1vdmVfdG9fc2FuKG1vdmUsIG1vdmVzKSB7CiAgICB2YXIgb3V0cHV0ID0gJycKCiAgICBpZiAobW92ZS5mbGFncyAmIEJJVFMuS1NJREVfQ0FTVExFKSB7CiAgICAgIG91dHB1dCA9ICdPLU8nCiAgICB9IGVsc2UgaWYgKG1vdmUuZmxhZ3MgJiBCSVRTLlFTSURFX0NBU1RMRSkgewogICAgICBvdXRwdXQgPSAnTy1PLU8nCiAgICB9IGVsc2UgewogICAgICBpZiAobW92ZS5waWVjZSAhPT0gUEFXTikgewogICAgICAgIHZhciBkaXNhbWJpZ3VhdG9yID0gZ2V0X2Rpc2FtYmlndWF0b3IobW92ZSwgbW92ZXMpCiAgICAgICAgb3V0cHV0ICs9IG1vdmUucGllY2UudG9VcHBlckNhc2UoKSArIGRpc2FtYmlndWF0b3IKICAgICAgfQoKICAgICAgaWYgKG1vdmUuZmxhZ3MgJiAoQklUUy5DQVBUVVJFIHwgQklUUy5FUF9DQVBUVVJFKSkgewogICAgICAgIGlmIChtb3ZlLnBpZWNlID09PSBQQVdOKSB7CiAgICAgICAgICBvdXRwdXQgKz0gYWxnZWJyYWljKG1vdmUuZnJvbSlbMF0KICAgICAgICB9CiAgICAgICAgb3V0cHV0ICs9ICd4JwogICAgICB9CgogICAgICBvdXRwdXQgKz0gYWxnZWJyYWljKG1vdmUudG8pCgogICAgICBpZiAobW92ZS5mbGFncyAmIEJJVFMuUFJPTU9USU9OKSB7CiAgICAgICAgb3V0cHV0ICs9ICc9JyArIG1vdmUucHJvbW90aW9uLnRvVXBwZXJDYXNlKCkKICAgICAgfQogICAgfQoKICAgIG1ha2VfbW92ZShtb3ZlKQogICAgaWYgKGluX2NoZWNrKCkpIHsKICAgICAgaWYgKGluX2NoZWNrbWF0ZSgpKSB7CiAgICAgICAgb3V0cHV0ICs9ICcjJwogICAgICB9IGVsc2UgewogICAgICAgIG91dHB1dCArPSAnKycKICAgICAgfQogICAgfQogICAgdW5kb19tb3ZlKCkKCiAgICByZXR1cm4gb3V0cHV0CiAgfQoKICBmdW5jdGlvbiBhdHRhY2tlZChjb2xvciwgc3F1YXJlKSB7CiAgICBmb3IgKHZhciBpID0gU1FVQVJFX01BUC5hODsgaSA8PSBTUVVBUkVfTUFQLmgxOyBpKyspIHsKICAgICAgLyogZGlkIHdlIHJ1biBvZmYgdGhlIGVuZCBvZiB0aGUgYm9hcmQgKi8KICAgICAgaWYgKGkgJiAweDg4KSB7CiAgICAgICAgaSArPSA3CiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgLyogaWYgZW1wdHkgc3F1YXJlIG9yIHdyb25nIGNvbG9yICovCiAgICAgIGlmIChib2FyZFtpXSA9PSBudWxsIHx8IGJvYXJkW2ldLmNvbG9yICE9PSBjb2xvcikgY29udGludWUKCiAgICAgIHZhciBwaWVjZSA9IGJvYXJkW2ldCiAgICAgIHZhciBkaWZmZXJlbmNlID0gaSAtIHNxdWFyZQogICAgICB2YXIgaW5kZXggPSBkaWZmZXJlbmNlICsgMTE5CgogICAgICBpZiAoQVRUQUNLU1tpbmRleF0gJiAoMSA8PCBTSElGVFNbcGllY2UudHlwZV0pKSB7CiAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09IFBBV04pIHsKICAgICAgICAgIGlmIChkaWZmZXJlbmNlID4gMCkgewogICAgICAgICAgICBpZiAocGllY2UuY29sb3IgPT09IFdISVRFKSByZXR1cm4gdHJ1ZQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHBpZWNlLmNvbG9yID09PSBCTEFDSykgcmV0dXJuIHRydWUKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICAvKiBpZiB0aGUgcGllY2UgaXMgYSBrbmlnaHQgb3IgYSBraW5nICovCiAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09ICduJyB8fCBwaWVjZS50eXBlID09PSAnaycpIHJldHVybiB0cnVlCgogICAgICAgIHZhciBvZmZzZXQgPSBSQVlTW2luZGV4XQogICAgICAgIHZhciBqID0gaSArIG9mZnNldAoKICAgICAgICB2YXIgYmxvY2tlZCA9IGZhbHNlCiAgICAgICAgd2hpbGUgKGogIT09IHNxdWFyZSkgewogICAgICAgICAgaWYgKGJvYXJkW2pdICE9IG51bGwpIHsKICAgICAgICAgICAgYmxvY2tlZCA9IHRydWUKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICAgIGogKz0gb2Zmc2V0CiAgICAgICAgfQoKICAgICAgICBpZiAoIWJsb2NrZWQpIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmN0aW9uIGtpbmdfYXR0YWNrZWQoY29sb3IpIHsKICAgIHJldHVybiBhdHRhY2tlZChzd2FwX2NvbG9yKGNvbG9yKSwga2luZ3NbY29sb3JdKQogIH0KCiAgZnVuY3Rpb24gaW5fY2hlY2soKSB7CiAgICByZXR1cm4ga2luZ19hdHRhY2tlZCh0dXJuKQogIH0KCiAgZnVuY3Rpb24gaW5fY2hlY2ttYXRlKCkgewogICAgcmV0dXJuIGluX2NoZWNrKCkgJiYgZ2VuZXJhdGVfbW92ZXMoKS5sZW5ndGggPT09IDAKICB9CgogIGZ1bmN0aW9uIGluX3N0YWxlbWF0ZSgpIHsKICAgIHJldHVybiAhaW5fY2hlY2soKSAmJiBnZW5lcmF0ZV9tb3ZlcygpLmxlbmd0aCA9PT0gMAogIH0KCiAgZnVuY3Rpb24gaW5zdWZmaWNpZW50X21hdGVyaWFsKCkgewogICAgdmFyIHBpZWNlcyA9IHt9CiAgICB2YXIgYmlzaG9wcyA9IFtdCiAgICB2YXIgbnVtX3BpZWNlcyA9IDAKICAgIHZhciBzcV9jb2xvciA9IDAKCiAgICBmb3IgKHZhciBpID0gU1FVQVJFX01BUC5hODsgaSA8PSBTUVVBUkVfTUFQLmgxOyBpKyspIHsKICAgICAgc3FfY29sb3IgPSAoc3FfY29sb3IgKyAxKSAlIDIKICAgICAgaWYgKGkgJiAweDg4KSB7CiAgICAgICAgaSArPSA3CiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgdmFyIHBpZWNlID0gYm9hcmRbaV0KICAgICAgaWYgKHBpZWNlKSB7CiAgICAgICAgcGllY2VzW3BpZWNlLnR5cGVdID0gcGllY2UudHlwZSBpbiBwaWVjZXMgPyBwaWVjZXNbcGllY2UudHlwZV0gKyAxIDogMQogICAgICAgIGlmIChwaWVjZS50eXBlID09PSBCSVNIT1ApIHsKICAgICAgICAgIGJpc2hvcHMucHVzaChzcV9jb2xvcikKICAgICAgICB9CiAgICAgICAgbnVtX3BpZWNlcysrCiAgICAgIH0KICAgIH0KCiAgICAvKiBrIHZzLiBrICovCiAgICBpZiAobnVtX3BpZWNlcyA9PT0gMikgewogICAgICByZXR1cm4gdHJ1ZQogICAgfSBlbHNlIGlmICgKICAgICAgLyogayB2cy4ga24gLi4uLiBvciAuLi4uIGsgdnMuIGtiICovCiAgICAgIG51bV9waWVjZXMgPT09IDMgJiYKICAgICAgKHBpZWNlc1tCSVNIT1BdID09PSAxIHx8IHBpZWNlc1tLTklHSFRdID09PSAxKQogICAgKSB7CiAgICAgIHJldHVybiB0cnVlCiAgICB9IGVsc2UgaWYgKG51bV9waWVjZXMgPT09IHBpZWNlc1tCSVNIT1BdICsgMikgewogICAgICAvKiBrYiB2cy4ga2Igd2hlcmUgYW55IG51bWJlciBvZiBiaXNob3BzIGFyZSBhbGwgb24gdGhlIHNhbWUgY29sb3IgKi8KICAgICAgdmFyIHN1bSA9IDAKICAgICAgdmFyIGxlbiA9IGJpc2hvcHMubGVuZ3RoCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBzdW0gKz0gYmlzaG9wc1tpXQogICAgICB9CiAgICAgIGlmIChzdW0gPT09IDAgfHwgc3VtID09PSBsZW4pIHsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBpbl90aHJlZWZvbGRfcmVwZXRpdGlvbigpIHsKICAgIC8qIFRPRE86IHdoaWxlIHRoaXMgZnVuY3Rpb24gaXMgZmluZSBmb3IgY2FzdWFsIHVzZSwgYSBiZXR0ZXIKICAgICAqIGltcGxlbWVudGF0aW9uIHdvdWxkIHVzZSBhIFpvYnJpc3Qga2V5IChpbnN0ZWFkIG9mIEZFTikuIHRoZQogICAgICogWm9icmlzdCBrZXkgd291bGQgYmUgbWFpbnRhaW5lZCBpbiB0aGUgbWFrZV9tb3ZlL3VuZG9fbW92ZSBmdW5jdGlvbnMsCiAgICAgKiBhdm9pZGluZyB0aGUgY29zdGx5IHRoYXQgd2UgZG8gYmVsb3cuCiAgICAgKi8KICAgIHZhciBtb3ZlcyA9IFtdCiAgICB2YXIgcG9zaXRpb25zID0ge30KICAgIHZhciByZXBldGl0aW9uID0gZmFsc2UKCiAgICB3aGlsZSAodHJ1ZSkgewogICAgICB2YXIgbW92ZSA9IHVuZG9fbW92ZSgpCiAgICAgIGlmICghbW92ZSkgYnJlYWsKICAgICAgbW92ZXMucHVzaChtb3ZlKQogICAgfQoKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIC8qIHJlbW92ZSB0aGUgbGFzdCB0d28gZmllbGRzIGluIHRoZSBGRU4gc3RyaW5nLCB0aGV5J3JlIG5vdCBuZWVkZWQKICAgICAgICogd2hlbiBjaGVja2luZyBmb3IgZHJhdyBieSByZXAgKi8KICAgICAgdmFyIGZlbiA9IGdlbmVyYXRlX2ZlbigpLnNwbGl0KCcgJykuc2xpY2UoMCwgNCkuam9pbignICcpCgogICAgICAvKiBoYXMgdGhlIHBvc2l0aW9uIG9jY3VycmVkIHRocmVlIG9yIG1vdmUgdGltZXMgKi8KICAgICAgcG9zaXRpb25zW2Zlbl0gPSBmZW4gaW4gcG9zaXRpb25zID8gcG9zaXRpb25zW2Zlbl0gKyAxIDogMQogICAgICBpZiAocG9zaXRpb25zW2Zlbl0gPj0gMykgewogICAgICAgIHJlcGV0aXRpb24gPSB0cnVlCiAgICAgIH0KCiAgICAgIGlmICghbW92ZXMubGVuZ3RoKSB7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBtYWtlX21vdmUobW92ZXMucG9wKCkpCiAgICB9CgogICAgcmV0dXJuIHJlcGV0aXRpb24KICB9CgogIGZ1bmN0aW9uIHB1c2gobW92ZSkgewogICAgaGlzdG9yeS5wdXNoKHsKICAgICAgbW92ZTogbW92ZSwKICAgICAga2luZ3M6IHsgYjoga2luZ3MuYiwgdzoga2luZ3MudyB9LAogICAgICB0dXJuOiB0dXJuLAogICAgICBjYXN0bGluZzogeyBiOiBjYXN0bGluZy5iLCB3OiBjYXN0bGluZy53IH0sCiAgICAgIGVwX3NxdWFyZTogZXBfc3F1YXJlLAogICAgICBoYWxmX21vdmVzOiBoYWxmX21vdmVzLAogICAgICBtb3ZlX251bWJlcjogbW92ZV9udW1iZXIsCiAgICB9KQogIH0KCiAgZnVuY3Rpb24gbWFrZV9tb3ZlKG1vdmUpIHsKICAgIHZhciB1cyA9IHR1cm4KICAgIHZhciB0aGVtID0gc3dhcF9jb2xvcih1cykKICAgIHB1c2gobW92ZSkKCiAgICBib2FyZFttb3ZlLnRvXSA9IGJvYXJkW21vdmUuZnJvbV0KICAgIGJvYXJkW21vdmUuZnJvbV0gPSBudWxsCgogICAgLyogaWYgZXAgY2FwdHVyZSwgcmVtb3ZlIHRoZSBjYXB0dXJlZCBwYXduICovCiAgICBpZiAobW92ZS5mbGFncyAmIEJJVFMuRVBfQ0FQVFVSRSkgewogICAgICBpZiAodHVybiA9PT0gQkxBQ0spIHsKICAgICAgICBib2FyZFttb3ZlLnRvIC0gMTZdID0gbnVsbAogICAgICB9IGVsc2UgewogICAgICAgIGJvYXJkW21vdmUudG8gKyAxNl0gPSBudWxsCiAgICAgIH0KICAgIH0KCiAgICAvKiBpZiBwYXduIHByb21vdGlvbiwgcmVwbGFjZSB3aXRoIG5ldyBwaWVjZSAqLwogICAgaWYgKG1vdmUuZmxhZ3MgJiBCSVRTLlBST01PVElPTikgewogICAgICBib2FyZFttb3ZlLnRvXSA9IHsgdHlwZTogbW92ZS5wcm9tb3Rpb24sIGNvbG9yOiB1cyB9CiAgICB9CgogICAgLyogaWYgd2UgbW92ZWQgdGhlIGtpbmcgKi8KICAgIGlmIChib2FyZFttb3ZlLnRvXS50eXBlID09PSBLSU5HKSB7CiAgICAgIGtpbmdzW2JvYXJkW21vdmUudG9dLmNvbG9yXSA9IG1vdmUudG8KCiAgICAgIC8qIGlmIHdlIGNhc3RsZWQsIG1vdmUgdGhlIHJvb2sgbmV4dCB0byB0aGUga2luZyAqLwogICAgICBpZiAobW92ZS5mbGFncyAmIEJJVFMuS1NJREVfQ0FTVExFKSB7CiAgICAgICAgdmFyIGNhc3RsaW5nX3RvID0gbW92ZS50byAtIDEKICAgICAgICB2YXIgY2FzdGxpbmdfZnJvbSA9IG1vdmUudG8gKyAxCiAgICAgICAgYm9hcmRbY2FzdGxpbmdfdG9dID0gYm9hcmRbY2FzdGxpbmdfZnJvbV0KICAgICAgICBib2FyZFtjYXN0bGluZ19mcm9tXSA9IG51bGwKICAgICAgfSBlbHNlIGlmIChtb3ZlLmZsYWdzICYgQklUUy5RU0lERV9DQVNUTEUpIHsKICAgICAgICB2YXIgY2FzdGxpbmdfdG8gPSBtb3ZlLnRvICsgMQogICAgICAgIHZhciBjYXN0bGluZ19mcm9tID0gbW92ZS50byAtIDIKICAgICAgICBib2FyZFtjYXN0bGluZ190b10gPSBib2FyZFtjYXN0bGluZ19mcm9tXQogICAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb21dID0gbnVsbAogICAgICB9CgogICAgICAvKiB0dXJuIG9mZiBjYXN0bGluZyAqLwogICAgICBjYXN0bGluZ1t1c10gPSAnJwogICAgfQoKICAgIC8qIHR1cm4gb2ZmIGNhc3RsaW5nIGlmIHdlIG1vdmUgYSByb29rICovCiAgICBpZiAoY2FzdGxpbmdbdXNdKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBST09LU1t1c10ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAoCiAgICAgICAgICBtb3ZlLmZyb20gPT09IFJPT0tTW3VzXVtpXS5zcXVhcmUgJiYKICAgICAgICAgIGNhc3RsaW5nW3VzXSAmIFJPT0tTW3VzXVtpXS5mbGFnCiAgICAgICAgKSB7CiAgICAgICAgICBjYXN0bGluZ1t1c10gXj0gUk9PS1NbdXNdW2ldLmZsYWcKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLyogdHVybiBvZmYgY2FzdGxpbmcgaWYgd2UgY2FwdHVyZSBhIHJvb2sgKi8KICAgIGlmIChjYXN0bGluZ1t0aGVtXSkgewogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gUk9PS1NbdGhlbV0ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAoCiAgICAgICAgICBtb3ZlLnRvID09PSBST09LU1t0aGVtXVtpXS5zcXVhcmUgJiYKICAgICAgICAgIGNhc3RsaW5nW3RoZW1dICYgUk9PS1NbdGhlbV1baV0uZmxhZwogICAgICAgICkgewogICAgICAgICAgY2FzdGxpbmdbdGhlbV0gXj0gUk9PS1NbdGhlbV1baV0uZmxhZwogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvKiBpZiBiaWcgcGF3biBtb3ZlLCB1cGRhdGUgdGhlIGVuIHBhc3NhbnQgc3F1YXJlICovCiAgICBpZiAobW92ZS5mbGFncyAmIEJJVFMuQklHX1BBV04pIHsKICAgICAgaWYgKHR1cm4gPT09ICdiJykgewogICAgICAgIGVwX3NxdWFyZSA9IG1vdmUudG8gLSAxNgogICAgICB9IGVsc2UgewogICAgICAgIGVwX3NxdWFyZSA9IG1vdmUudG8gKyAxNgogICAgICB9CiAgICB9IGVsc2UgewogICAgICBlcF9zcXVhcmUgPSBFTVBUWQogICAgfQoKICAgIC8qIHJlc2V0IHRoZSA1MCBtb3ZlIGNvdW50ZXIgaWYgYSBwYXduIGlzIG1vdmVkIG9yIGEgcGllY2UgaXMgY2FwdHVyZWQgKi8KICAgIGlmIChtb3ZlLnBpZWNlID09PSBQQVdOKSB7CiAgICAgIGhhbGZfbW92ZXMgPSAwCiAgICB9IGVsc2UgaWYgKG1vdmUuZmxhZ3MgJiAoQklUUy5DQVBUVVJFIHwgQklUUy5FUF9DQVBUVVJFKSkgewogICAgICBoYWxmX21vdmVzID0gMAogICAgfSBlbHNlIHsKICAgICAgaGFsZl9tb3ZlcysrCiAgICB9CgogICAgaWYgKHR1cm4gPT09IEJMQUNLKSB7CiAgICAgIG1vdmVfbnVtYmVyKysKICAgIH0KICAgIHR1cm4gPSBzd2FwX2NvbG9yKHR1cm4pCiAgfQoKICBmdW5jdGlvbiB1bmRvX21vdmUoKSB7CiAgICB2YXIgb2xkID0gaGlzdG9yeS5wb3AoKQogICAgaWYgKG9sZCA9PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsCiAgICB9CgogICAgdmFyIG1vdmUgPSBvbGQubW92ZQogICAga2luZ3MgPSBvbGQua2luZ3MKICAgIHR1cm4gPSBvbGQudHVybgogICAgY2FzdGxpbmcgPSBvbGQuY2FzdGxpbmcKICAgIGVwX3NxdWFyZSA9IG9sZC5lcF9zcXVhcmUKICAgIGhhbGZfbW92ZXMgPSBvbGQuaGFsZl9tb3ZlcwogICAgbW92ZV9udW1iZXIgPSBvbGQubW92ZV9udW1iZXIKCiAgICB2YXIgdXMgPSB0dXJuCiAgICB2YXIgdGhlbSA9IHN3YXBfY29sb3IodHVybikKCiAgICBib2FyZFttb3ZlLmZyb21dID0gYm9hcmRbbW92ZS50b10KICAgIGJvYXJkW21vdmUuZnJvbV0udHlwZSA9IG1vdmUucGllY2UgLy8gdG8gdW5kbyBhbnkgcHJvbW90aW9ucwogICAgYm9hcmRbbW92ZS50b10gPSBudWxsCgogICAgaWYgKG1vdmUuZmxhZ3MgJiBCSVRTLkNBUFRVUkUpIHsKICAgICAgYm9hcmRbbW92ZS50b10gPSB7IHR5cGU6IG1vdmUuY2FwdHVyZWQsIGNvbG9yOiB0aGVtIH0KICAgIH0gZWxzZSBpZiAobW92ZS5mbGFncyAmIEJJVFMuRVBfQ0FQVFVSRSkgewogICAgICB2YXIgaW5kZXgKICAgICAgaWYgKHVzID09PSBCTEFDSykgewogICAgICAgIGluZGV4ID0gbW92ZS50byAtIDE2CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5kZXggPSBtb3ZlLnRvICsgMTYKICAgICAgfQogICAgICBib2FyZFtpbmRleF0gPSB7IHR5cGU6IFBBV04sIGNvbG9yOiB0aGVtIH0KICAgIH0KCiAgICBpZiAobW92ZS5mbGFncyAmIChCSVRTLktTSURFX0NBU1RMRSB8IEJJVFMuUVNJREVfQ0FTVExFKSkgewogICAgICB2YXIgY2FzdGxpbmdfdG8sIGNhc3RsaW5nX2Zyb20KICAgICAgaWYgKG1vdmUuZmxhZ3MgJiBCSVRTLktTSURFX0NBU1RMRSkgewogICAgICAgIGNhc3RsaW5nX3RvID0gbW92ZS50byArIDEKICAgICAgICBjYXN0bGluZ19mcm9tID0gbW92ZS50byAtIDEKICAgICAgfSBlbHNlIGlmIChtb3ZlLmZsYWdzICYgQklUUy5RU0lERV9DQVNUTEUpIHsKICAgICAgICBjYXN0bGluZ190byA9IG1vdmUudG8gLSAyCiAgICAgICAgY2FzdGxpbmdfZnJvbSA9IG1vdmUudG8gKyAxCiAgICAgIH0KCiAgICAgIGJvYXJkW2Nhc3RsaW5nX3RvXSA9IGJvYXJkW2Nhc3RsaW5nX2Zyb21dCiAgICAgIGJvYXJkW2Nhc3RsaW5nX2Zyb21dID0gbnVsbAogICAgfQoKICAgIHJldHVybiBtb3ZlCiAgfQoKICAvLyBjb252ZXJ0IGEgbW92ZSBmcm9tIFN0YW5kYXJkIEFsZ2VicmFpYyBOb3RhdGlvbiAoU0FOKSB0byAweDg4IGNvb3JkaW5hdGVzCiAgZnVuY3Rpb24gbW92ZV9mcm9tX3Nhbihtb3ZlLCBzbG9wcHkpIHsKICAgIC8vIHN0cmlwIG9mZiBhbnkgbW92ZSBkZWNvcmF0aW9uczogZS5nIE5mMys/ISBiZWNvbWVzIE5mMwogICAgdmFyIGNsZWFuX21vdmUgPSBzdHJpcHBlZF9zYW4obW92ZSkKCiAgICAvLyB0aGUgbW92ZSBwYXJzZXJzIGlzIGEgMi1zdGVwIHN0YXRlCiAgICBmb3IgKHZhciBwYXJzZXIgPSAwOyBwYXJzZXIgPCAyOyBwYXJzZXIrKykgewogICAgICBpZiAocGFyc2VyID09IFBBUlNFUl9TTE9QUFkpIHsKICAgICAgICAvLyBvbmx5IHJ1biB0aGUgc2xvcHB5IHBhcnNlIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkCiAgICAgICAgaWYgKCFzbG9wcHkpIHsKICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICAvLyBUaGUgc2xvcHB5IHBhcnNlciBhbGxvd3MgdGhlIHVzZXIgdG8gcGFyc2Ugbm9uLXN0YW5kYXJkIGNoZXNzCiAgICAgICAgLy8gbm90YXRpb25zLiBUaGlzIHBhcnNlciBpcyBvcHQtaW4gKGJ5IHNwZWNpZnlpbmcgdGhlCiAgICAgICAgLy8gJ3sgc2xvcHB5OiB0cnVlIH0nIHNldHRpbmcpIGFuZCBpcyBvbmx5IHJ1biBhZnRlciB0aGUgU3RhbmRhcmQKICAgICAgICAvLyBBbGdlYnJhaWMgTm90YXRpb24gKFNBTikgcGFyc2VyIGhhcyBmYWlsZWQuCiAgICAgICAgLy8KICAgICAgICAvLyBXaGVuIHJ1bm5pbmcgdGhlIHNsb3BweSBwYXJzZXIsIHdlJ2xsIHJ1biBhIHJlZ2V4IHRvIGdyYWIgdGhlIHBpZWNlLAogICAgICAgIC8vIHRoZSB0by9mcm9tIHNxdWFyZSwgYW5kIGFuIG9wdGlvbmFsIHByb21vdGlvbiBwaWVjZS4gVGhpcyByZWdleCB3aWxsCiAgICAgICAgLy8gcGFyc2UgY29tbW9uIG5vbi1zdGFuZGFyZCBub3RhdGlvbiBsaWtlOiBQZTItZTQsIFJjMWM0LCBRZjN4ZjcsCiAgICAgICAgLy8gZjdmOHEsIGIxYzMKCiAgICAgICAgLy8gTk9URTogU29tZSBwb3NpdGlvbnMgYW5kIG1vdmVzIG1heSBiZSBhbWJpZ3VvdXMgd2hlbiB1c2luZyB0aGUKICAgICAgICAvLyBzbG9wcHkgcGFyc2VyLiBGb3IgZXhhbXBsZSwgaW4gdGhpcyBwb3NpdGlvbjoKICAgICAgICAvLyA2azEvOC84L0I3LzgvOC84L0JONEsxIHcgLSAtIDAgMSwgdGhlIG1vdmUgYjFjMyBtYXkgYmUgaW50ZXJwcmV0ZWQKICAgICAgICAvLyBhcyBOYzMgb3IgQjFjMyAoYSBkaXNhbWJpZ3VhdGVkIGJpc2hvcCBtb3ZlKS4gSW4gdGhlc2UgY2FzZXMsIHRoZQogICAgICAgIC8vIHNsb3BweSBwYXJzZXIgd2lsbCBkZWZhdWx0IHRvIHRoZSBtb3N0IG1vc3QgYmFzaWMgaW50ZXJwcmV0YXRpb24KICAgICAgICAvLyAod2hpY2ggaXMgYjFjMyBwYXJzaW5nIHRvIE5jMykuCgogICAgICAgIC8vIEZJWE1FOiB0aGVzZSB2YXIncyBhcmUgaG9pc3RlZCBpbnRvIGZ1bmN0aW9uIHNjb3BlLCB0aGlzIHdpbGwgbmVlZAogICAgICAgIC8vIHRvIGNoYW5nZSB3aGVuIHN3aXRjaGluZyB0byBjb25zdC9sZXQKCiAgICAgICAgdmFyIG92ZXJseV9kaXNhbWJpZ3VhdGVkID0gZmFsc2UKCiAgICAgICAgdmFyIG1hdGNoZXMgPSBjbGVhbl9tb3ZlLm1hdGNoKAogICAgICAgICAgLyhbcG5icnFrUE5CUlFLXSk/KFthLWhdWzEtOF0peD8tPyhbYS1oXVsxLThdKShbcXJiblFSQk5dKT8vCiAgICAgICAgKQogICAgICAgIGlmIChtYXRjaGVzKSB7CiAgICAgICAgICB2YXIgcGllY2UgPSBtYXRjaGVzWzFdCiAgICAgICAgICB2YXIgZnJvbSA9IG1hdGNoZXNbMl0KICAgICAgICAgIHZhciB0byA9IG1hdGNoZXNbM10KICAgICAgICAgIHZhciBwcm9tb3Rpb24gPSBtYXRjaGVzWzRdCgogICAgICAgICAgaWYgKGZyb20ubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgb3Zlcmx5X2Rpc2FtYmlndWF0ZWQgPSB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFRoZSBbYS1oXT9bMS04XT8gcG9ydGlvbiBvZiB0aGUgcmVnZXggYmVsb3cgaGFuZGxlcyBtb3ZlcyB0aGF0IG1heQogICAgICAgICAgLy8gYmUgb3Zlcmx5IGRpc2FtYmlndWF0ZWQgKGUuZy4gTmdlNyBpcyB1bm5lY2Vzc2FyeSBhbmQgbm9uLXN0YW5kYXJkCiAgICAgICAgICAvLyB3aGVuIHRoZXJlIGlzIG9uZSBsZWdhbCBrbmlnaHQgbW92ZSB0byBlNykuIEluIHRoaXMgY2FzZSwgdGhlIHZhbHVlCiAgICAgICAgICAvLyBvZiAnZnJvbScgdmFyaWFibGUgd2lsbCBiZSBhIHJhbmsgb3IgZmlsZSwgbm90IGEgc3F1YXJlLgogICAgICAgICAgdmFyIG1hdGNoZXMgPSBjbGVhbl9tb3ZlLm1hdGNoKAogICAgICAgICAgICAvKFtwbmJycWtQTkJSUUtdKT8oW2EtaF0/WzEtOF0/KXg/LT8oW2EtaF1bMS04XSkoW3FyYm5RUkJOXSk/LwogICAgICAgICAgKQoKICAgICAgICAgIGlmIChtYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBwaWVjZSA9IG1hdGNoZXNbMV0KICAgICAgICAgICAgdmFyIGZyb20gPSBtYXRjaGVzWzJdCiAgICAgICAgICAgIHZhciB0byA9IG1hdGNoZXNbM10KICAgICAgICAgICAgdmFyIHByb21vdGlvbiA9IG1hdGNoZXNbNF0KCiAgICAgICAgICAgIGlmIChmcm9tLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgdmFyIG92ZXJseV9kaXNhbWJpZ3VhdGVkID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgcGllY2VfdHlwZSA9IGluZmVyX3BpZWNlX3R5cGUoY2xlYW5fbW92ZSkKICAgICAgdmFyIG1vdmVzID0gZ2VuZXJhdGVfbW92ZXMoewogICAgICAgIGxlZ2FsOiB0cnVlLAogICAgICAgIHBpZWNlOiBwaWVjZSA/IHBpZWNlIDogcGllY2VfdHlwZSwKICAgICAgfSkKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBtb3Zlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHN3aXRjaCAocGFyc2VyKSB7CiAgICAgICAgICBjYXNlIFBBUlNFUl9TVFJJQ1Q6IHsKICAgICAgICAgICAgaWYgKGNsZWFuX21vdmUgPT09IHN0cmlwcGVkX3Nhbihtb3ZlX3RvX3Nhbihtb3Zlc1tpXSwgbW92ZXMpKSkgewogICAgICAgICAgICAgIHJldHVybiBtb3Zlc1tpXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBjYXNlIFBBUlNFUl9TTE9QUFk6IHsKICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHsKICAgICAgICAgICAgICAvLyBoYW5kLWNvbXBhcmUgbW92ZSBwcm9wZXJ0aWVzIHdpdGggdGhlIHJlc3VsdHMgZnJvbSBvdXIgc2xvcHB5CiAgICAgICAgICAgICAgLy8gcmVnZXgKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAoIXBpZWNlIHx8IHBpZWNlLnRvTG93ZXJDYXNlKCkgPT0gbW92ZXNbaV0ucGllY2UpICYmCiAgICAgICAgICAgICAgICBTUVVBUkVfTUFQW2Zyb21dID09IG1vdmVzW2ldLmZyb20gJiYKICAgICAgICAgICAgICAgIFNRVUFSRV9NQVBbdG9dID09IG1vdmVzW2ldLnRvICYmCiAgICAgICAgICAgICAgICAoIXByb21vdGlvbiB8fCBwcm9tb3Rpb24udG9Mb3dlckNhc2UoKSA9PSBtb3Zlc1tpXS5wcm9tb3Rpb24pCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbW92ZXNbaV0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJseV9kaXNhbWJpZ3VhdGVkKSB7CiAgICAgICAgICAgICAgICAvLyBTUEVDSUFMIENBU0U6IHdlIHBhcnNlZCBhIG1vdmUgc3RyaW5nIHRoYXQgbWF5IGhhdmUgYW4KICAgICAgICAgICAgICAgIC8vIHVubmVlZGVkIHJhbmsvZmlsZSBkaXNhbWJpZ3VhdG9yIChlLmcuIE5nZTcpLiAgVGhlICdmcm9tJwogICAgICAgICAgICAgICAgLy8gdmFyaWFibGUgd2lsbAogICAgICAgICAgICAgICAgdmFyIHNxdWFyZSA9IGFsZ2VicmFpYyhtb3Zlc1tpXS5mcm9tKQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAoIXBpZWNlIHx8IHBpZWNlLnRvTG93ZXJDYXNlKCkgPT0gbW92ZXNbaV0ucGllY2UpICYmCiAgICAgICAgICAgICAgICAgIFNRVUFSRV9NQVBbdG9dID09IG1vdmVzW2ldLnRvICYmCiAgICAgICAgICAgICAgICAgIChmcm9tID09IHNxdWFyZVswXSB8fCBmcm9tID09IHNxdWFyZVsxXSkgJiYKICAgICAgICAgICAgICAgICAgKCFwcm9tb3Rpb24gfHwgcHJvbW90aW9uLnRvTG93ZXJDYXNlKCkgPT0gbW92ZXNbaV0ucHJvbW90aW9uKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBtb3Zlc1tpXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBudWxsCiAgfQoKICAvKiBwcmV0dHkgPSBleHRlcm5hbCBtb3ZlIG9iamVjdCAqLwogIGZ1bmN0aW9uIG1ha2VfcHJldHR5KHVnbHlfbW92ZSkgewogICAgdmFyIG1vdmUgPSBjbG9uZSh1Z2x5X21vdmUpCiAgICBtb3ZlLnNhbiA9IG1vdmVfdG9fc2FuKG1vdmUsIGdlbmVyYXRlX21vdmVzKHsgbGVnYWw6IHRydWUgfSkpCiAgICBtb3ZlLnRvID0gYWxnZWJyYWljKG1vdmUudG8pCiAgICBtb3ZlLmZyb20gPSBhbGdlYnJhaWMobW92ZS5mcm9tKQoKICAgIHZhciBmbGFncyA9ICcnCgogICAgZm9yICh2YXIgZmxhZyBpbiBCSVRTKSB7CiAgICAgIGlmIChCSVRTW2ZsYWddICYgbW92ZS5mbGFncykgewogICAgICAgIGZsYWdzICs9IEZMQUdTW2ZsYWddCiAgICAgIH0KICAgIH0KICAgIG1vdmUuZmxhZ3MgPSBmbGFncwoKICAgIHJldHVybiBtb3ZlCiAgfQoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgKiBERUJVR0dJTkcgVVRJTElUSUVTCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgZnVuY3Rpb24gcGVyZnQoZGVwdGgpIHsKICAgIHZhciBtb3ZlcyA9IGdlbmVyYXRlX21vdmVzKHsgbGVnYWw6IGZhbHNlIH0pCiAgICB2YXIgbm9kZXMgPSAwCiAgICB2YXIgY29sb3IgPSB0dXJuCgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG1vdmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIG1ha2VfbW92ZShtb3Zlc1tpXSkKICAgICAgaWYgKCFraW5nX2F0dGFja2VkKGNvbG9yKSkgewogICAgICAgIGlmIChkZXB0aCAtIDEgPiAwKSB7CiAgICAgICAgICB2YXIgY2hpbGRfbm9kZXMgPSBwZXJmdChkZXB0aCAtIDEpCiAgICAgICAgICBub2RlcyArPSBjaGlsZF9ub2RlcwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlcysrCiAgICAgICAgfQogICAgICB9CiAgICAgIHVuZG9fbW92ZSgpCiAgICB9CgogICAgcmV0dXJuIG5vZGVzCiAgfQoKICByZXR1cm4gewogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICogUFVCTElDIEFQSQogICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgbG9hZDogZnVuY3Rpb24gKGZlbikgewogICAgICByZXR1cm4gbG9hZChmZW4pCiAgICB9LAoKICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiByZXNldCgpCiAgICB9LAoKICAgIG1vdmVzOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAvKiBUaGUgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgYSBjaGVzcyBtb3ZlIGlzIGluIDB4ODggZm9ybWF0LCBhbmQKICAgICAgICogbm90IG1lYW50IHRvIGJlIGh1bWFuLXJlYWRhYmxlLiAgVGhlIGNvZGUgYmVsb3cgY29udmVydHMgdGhlIDB4ODgKICAgICAgICogc3F1YXJlIGNvb3JkaW5hdGVzIHRvIGFsZ2VicmFpYyBjb29yZGluYXRlcy4gIEl0IGFsc28gcHJ1bmVzIGFuCiAgICAgICAqIHVubmVjZXNzYXJ5IG1vdmUga2V5cyByZXN1bHRpbmcgZnJvbSBhIHZlcmJvc2UgY2FsbC4KICAgICAgICovCgogICAgICB2YXIgdWdseV9tb3ZlcyA9IGdlbmVyYXRlX21vdmVzKG9wdGlvbnMpCiAgICAgIHZhciBtb3ZlcyA9IFtdCgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdWdseV9tb3Zlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIC8qIGRvZXMgdGhlIHVzZXIgd2FudCBhIGZ1bGwgbW92ZSBvYmplY3QgKG1vc3QgbGlrZWx5IG5vdCksIG9yIGp1c3QKICAgICAgICAgKiBTQU4KICAgICAgICAgKi8KICAgICAgICBpZiAoCiAgICAgICAgICB0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYKICAgICAgICAgICd2ZXJib3NlJyBpbiBvcHRpb25zICYmCiAgICAgICAgICBvcHRpb25zLnZlcmJvc2UKICAgICAgICApIHsKICAgICAgICAgIG1vdmVzLnB1c2gobWFrZV9wcmV0dHkodWdseV9tb3Zlc1tpXSkpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vdmVzLnB1c2goCiAgICAgICAgICAgIG1vdmVfdG9fc2FuKHVnbHlfbW92ZXNbaV0sIGdlbmVyYXRlX21vdmVzKHsgbGVnYWw6IHRydWUgfSkpCiAgICAgICAgICApCiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbW92ZXMKICAgIH0sCgogICAgaW5fY2hlY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGluX2NoZWNrKCkKICAgIH0sCgogICAgaW5fY2hlY2ttYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBpbl9jaGVja21hdGUoKQogICAgfSwKCiAgICBpbl9zdGFsZW1hdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGluX3N0YWxlbWF0ZSgpCiAgICB9LAoKICAgIGluX2RyYXc6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICgKICAgICAgICBoYWxmX21vdmVzID49IDEwMCB8fAogICAgICAgIGluX3N0YWxlbWF0ZSgpIHx8CiAgICAgICAgaW5zdWZmaWNpZW50X21hdGVyaWFsKCkgfHwKICAgICAgICBpbl90aHJlZWZvbGRfcmVwZXRpdGlvbigpCiAgICAgICkKICAgIH0sCgogICAgaW5zdWZmaWNpZW50X21hdGVyaWFsOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBpbnN1ZmZpY2llbnRfbWF0ZXJpYWwoKQogICAgfSwKCiAgICBpbl90aHJlZWZvbGRfcmVwZXRpdGlvbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gaW5fdGhyZWVmb2xkX3JlcGV0aXRpb24oKQogICAgfSwKCiAgICBnYW1lX292ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICgKICAgICAgICBoYWxmX21vdmVzID49IDEwMCB8fAogICAgICAgIGluX2NoZWNrbWF0ZSgpIHx8CiAgICAgICAgaW5fc3RhbGVtYXRlKCkgfHwKICAgICAgICBpbnN1ZmZpY2llbnRfbWF0ZXJpYWwoKSB8fAogICAgICAgIGluX3RocmVlZm9sZF9yZXBldGl0aW9uKCkKICAgICAgKQogICAgfSwKCiAgICB2YWxpZGF0ZV9mZW46IGZ1bmN0aW9uIChmZW4pIHsKICAgICAgcmV0dXJuIHZhbGlkYXRlX2ZlbihmZW4pCiAgICB9LAoKICAgIGZlbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gZ2VuZXJhdGVfZmVuKCkKICAgIH0sCgogICAgYm9hcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG91dHB1dCA9IFtdLAogICAgICAgIHJvdyA9IFtdCgogICAgICBmb3IgKHZhciBpID0gU1FVQVJFX01BUC5hODsgaSA8PSBTUVVBUkVfTUFQLmgxOyBpKyspIHsKICAgICAgICBpZiAoYm9hcmRbaV0gPT0gbnVsbCkgewogICAgICAgICAgcm93LnB1c2gobnVsbCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm93LnB1c2goewogICAgICAgICAgICBzcXVhcmU6IGFsZ2VicmFpYyhpKSwKICAgICAgICAgICAgdHlwZTogYm9hcmRbaV0udHlwZSwKICAgICAgICAgICAgY29sb3I6IGJvYXJkW2ldLmNvbG9yLAogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgaWYgKChpICsgMSkgJiAweDg4KSB7CiAgICAgICAgICBvdXRwdXQucHVzaChyb3cpCiAgICAgICAgICByb3cgPSBbXQogICAgICAgICAgaSArPSA4CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb3V0cHV0CiAgICB9LAoKICAgIHBnbjogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgLyogdXNpbmcgdGhlIHNwZWNpZmljYXRpb24gZnJvbSBodHRwOi8vd3d3LmNoZXNzY2x1Yi5jb20vaGVscC9QR04tc3BlYwogICAgICAgKiBleGFtcGxlIGZvciBodG1sIHVzYWdlOiAucGduKHsgbWF4X3dpZHRoOiA3MiwgbmV3bGluZV9jaGFyOiAiPGJyIC8+IiB9KQogICAgICAgKi8KICAgICAgdmFyIG5ld2xpbmUgPQogICAgICAgIHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JyAmJiB0eXBlb2Ygb3B0aW9ucy5uZXdsaW5lX2NoYXIgPT09ICdzdHJpbmcnCiAgICAgICAgICA/IG9wdGlvbnMubmV3bGluZV9jaGFyCiAgICAgICAgICA6ICdcbicKICAgICAgdmFyIG1heF93aWR0aCA9CiAgICAgICAgdHlwZW9mIG9wdGlvbnMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBvcHRpb25zLm1heF93aWR0aCA9PT0gJ251bWJlcicKICAgICAgICAgID8gb3B0aW9ucy5tYXhfd2lkdGgKICAgICAgICAgIDogMAogICAgICB2YXIgcmVzdWx0ID0gW10KICAgICAgdmFyIGhlYWRlcl9leGlzdHMgPSBmYWxzZQoKICAgICAgLyogYWRkIHRoZSBQR04gaGVhZGVyIGluZm9ybWF0aW9uICovCiAgICAgIGZvciAodmFyIGkgaW4gaGVhZGVyKSB7CiAgICAgICAgLyogVE9ETzogb3JkZXIgb2YgZW51bWVyYXRlZCBwcm9wZXJ0aWVzIGluIGhlYWRlciBvYmplY3QgaXMgbm90CiAgICAgICAgICogZ3VhcmFudGVlZCwgc2VlIEVDTUEtMjYyIHNwZWMgKHNlY3Rpb24gMTIuNi40KQogICAgICAgICAqLwogICAgICAgIHJlc3VsdC5wdXNoKCdbJyArIGkgKyAnICInICsgaGVhZGVyW2ldICsgJyJdJyArIG5ld2xpbmUpCiAgICAgICAgaGVhZGVyX2V4aXN0cyA9IHRydWUKICAgICAgfQoKICAgICAgaWYgKGhlYWRlcl9leGlzdHMgJiYgaGlzdG9yeS5sZW5ndGgpIHsKICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKQogICAgICB9CgogICAgICB2YXIgYXBwZW5kX2NvbW1lbnQgPSBmdW5jdGlvbiAobW92ZV9zdHJpbmcpIHsKICAgICAgICB2YXIgY29tbWVudCA9IGNvbW1lbnRzW2dlbmVyYXRlX2ZlbigpXQogICAgICAgIGlmICh0eXBlb2YgY29tbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHZhciBkZWxpbWl0ZXIgPSBtb3ZlX3N0cmluZy5sZW5ndGggPiAwID8gJyAnIDogJycKICAgICAgICAgIG1vdmVfc3RyaW5nID0gYCR7bW92ZV9zdHJpbmd9JHtkZWxpbWl0ZXJ9eyR7Y29tbWVudH19YAogICAgICAgIH0KICAgICAgICByZXR1cm4gbW92ZV9zdHJpbmcKICAgICAgfQoKICAgICAgLyogcG9wIGFsbCBvZiBoaXN0b3J5IG9udG8gcmV2ZXJzZWRfaGlzdG9yeSAqLwogICAgICB2YXIgcmV2ZXJzZWRfaGlzdG9yeSA9IFtdCiAgICAgIHdoaWxlIChoaXN0b3J5Lmxlbmd0aCA+IDApIHsKICAgICAgICByZXZlcnNlZF9oaXN0b3J5LnB1c2godW5kb19tb3ZlKCkpCiAgICAgIH0KCiAgICAgIHZhciBtb3ZlcyA9IFtdCiAgICAgIHZhciBtb3ZlX3N0cmluZyA9ICcnCgogICAgICAvKiBzcGVjaWFsIGNhc2Ugb2YgYSBjb21tZW50ZWQgc3RhcnRpbmcgcG9zaXRpb24gd2l0aCBubyBtb3ZlcyAqLwogICAgICBpZiAocmV2ZXJzZWRfaGlzdG9yeS5sZW5ndGggPT09IDApIHsKICAgICAgICBtb3Zlcy5wdXNoKGFwcGVuZF9jb21tZW50KCcnKSkKICAgICAgfQoKICAgICAgLyogYnVpbGQgdGhlIGxpc3Qgb2YgbW92ZXMuICBhIG1vdmVfc3RyaW5nIGxvb2tzIGxpa2U6ICIzLiBlMyBlNiIgKi8KICAgICAgd2hpbGUgKHJldmVyc2VkX2hpc3RvcnkubGVuZ3RoID4gMCkgewogICAgICAgIG1vdmVfc3RyaW5nID0gYXBwZW5kX2NvbW1lbnQobW92ZV9zdHJpbmcpCiAgICAgICAgdmFyIG1vdmUgPSByZXZlcnNlZF9oaXN0b3J5LnBvcCgpCgogICAgICAgIC8qIGlmIHRoZSBwb3NpdGlvbiBzdGFydGVkIHdpdGggYmxhY2sgdG8gbW92ZSwgc3RhcnQgUEdOIHdpdGggIy4gLi4uICovCiAgICAgICAgaWYgKCFoaXN0b3J5Lmxlbmd0aCAmJiBtb3ZlLmNvbG9yID09PSAnYicpIHsKICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGAke21vdmVfbnVtYmVyfS4gLi4uYAogICAgICAgICAgLyogaXMgdGhlcmUgYSBjb21tZW50IHByZWNlZGluZyB0aGUgZmlyc3QgbW92ZT8gKi8KICAgICAgICAgIG1vdmVfc3RyaW5nID0gbW92ZV9zdHJpbmcgPyBgJHttb3ZlX3N0cmluZ30gJHtwcmVmaXh9YCA6IHByZWZpeAogICAgICAgIH0gZWxzZSBpZiAobW92ZS5jb2xvciA9PT0gJ3cnKSB7CiAgICAgICAgICAvKiBzdG9yZSB0aGUgcHJldmlvdXMgZ2VuZXJhdGVkIG1vdmVfc3RyaW5nIGlmIHdlIGhhdmUgb25lICovCiAgICAgICAgICBpZiAobW92ZV9zdHJpbmcubGVuZ3RoKSB7CiAgICAgICAgICAgIG1vdmVzLnB1c2gobW92ZV9zdHJpbmcpCiAgICAgICAgICB9CiAgICAgICAgICBtb3ZlX3N0cmluZyA9IG1vdmVfbnVtYmVyICsgJy4nCiAgICAgICAgfQoKICAgICAgICBtb3ZlX3N0cmluZyA9CiAgICAgICAgICBtb3ZlX3N0cmluZyArICcgJyArIG1vdmVfdG9fc2FuKG1vdmUsIGdlbmVyYXRlX21vdmVzKHsgbGVnYWw6IHRydWUgfSkpCiAgICAgICAgbWFrZV9tb3ZlKG1vdmUpCiAgICAgIH0KCiAgICAgIC8qIGFyZSB0aGVyZSBhbnkgb3RoZXIgbGVmdG92ZXIgbW92ZXM/ICovCiAgICAgIGlmIChtb3ZlX3N0cmluZy5sZW5ndGgpIHsKICAgICAgICBtb3Zlcy5wdXNoKGFwcGVuZF9jb21tZW50KG1vdmVfc3RyaW5nKSkKICAgICAgfQoKICAgICAgLyogaXMgdGhlcmUgYSByZXN1bHQ/ICovCiAgICAgIGlmICh0eXBlb2YgaGVhZGVyLlJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBtb3Zlcy5wdXNoKGhlYWRlci5SZXN1bHQpCiAgICAgIH0KCiAgICAgIC8qIGhpc3Rvcnkgc2hvdWxkIGJlIGJhY2sgdG8gd2hhdCBpdCB3YXMgYmVmb3JlIHdlIHN0YXJ0ZWQgZ2VuZXJhdGluZyBQR04sCiAgICAgICAqIHNvIGpvaW4gdG9nZXRoZXIgbW92ZXMKICAgICAgICovCiAgICAgIGlmIChtYXhfd2lkdGggPT09IDApIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oJycpICsgbW92ZXMuam9pbignICcpCiAgICAgIH0KCiAgICAgIHZhciBzdHJpcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAxXSA9PT0gJyAnKSB7CiAgICAgICAgICByZXN1bHQucG9wKCkKICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CgogICAgICAvKiBOQjogdGhpcyBkb2VzIG5vdCBwcmVzZXJ2ZSBjb21tZW50IHdoaXRlc3BhY2UuICovCiAgICAgIHZhciB3cmFwX2NvbW1lbnQgPSBmdW5jdGlvbiAod2lkdGgsIG1vdmUpIHsKICAgICAgICBmb3IgKHZhciB0b2tlbiBvZiBtb3ZlLnNwbGl0KCcgJykpIHsKICAgICAgICAgIGlmICghdG9rZW4pIHsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KICAgICAgICAgIGlmICh3aWR0aCArIHRva2VuLmxlbmd0aCA+IG1heF93aWR0aCkgewogICAgICAgICAgICB3aGlsZSAoc3RyaXAoKSkgewogICAgICAgICAgICAgIHdpZHRoLS0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKQogICAgICAgICAgICB3aWR0aCA9IDAKICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdC5wdXNoKHRva2VuKQogICAgICAgICAgd2lkdGggKz0gdG9rZW4ubGVuZ3RoCiAgICAgICAgICByZXN1bHQucHVzaCgnICcpCiAgICAgICAgICB3aWR0aCsrCiAgICAgICAgfQogICAgICAgIGlmIChzdHJpcCgpKSB7CiAgICAgICAgICB3aWR0aC0tCiAgICAgICAgfQogICAgICAgIHJldHVybiB3aWR0aAogICAgICB9CgogICAgICAvKiB3cmFwIHRoZSBQR04gb3V0cHV0IGF0IG1heF93aWR0aCAqLwogICAgICB2YXIgY3VycmVudF93aWR0aCA9IDAKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtb3Zlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChjdXJyZW50X3dpZHRoICsgbW92ZXNbaV0ubGVuZ3RoID4gbWF4X3dpZHRoKSB7CiAgICAgICAgICBpZiAobW92ZXNbaV0uaW5jbHVkZXMoJ3snKSkgewogICAgICAgICAgICBjdXJyZW50X3dpZHRoID0gd3JhcF9jb21tZW50KGN1cnJlbnRfd2lkdGgsIG1vdmVzW2ldKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKiBpZiB0aGUgY3VycmVudCBtb3ZlIHdpbGwgcHVzaCBwYXN0IG1heF93aWR0aCAqLwogICAgICAgIGlmIChjdXJyZW50X3dpZHRoICsgbW92ZXNbaV0ubGVuZ3RoID4gbWF4X3dpZHRoICYmIGkgIT09IDApIHsKICAgICAgICAgIC8qIGRvbid0IGVuZCB0aGUgbGluZSB3aXRoIHdoaXRlc3BhY2UgKi8KICAgICAgICAgIGlmIChyZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdID09PSAnICcpIHsKICAgICAgICAgICAgcmVzdWx0LnBvcCgpCiAgICAgICAgICB9CgogICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSkKICAgICAgICAgIGN1cnJlbnRfd2lkdGggPSAwCiAgICAgICAgfSBlbHNlIGlmIChpICE9PSAwKSB7CiAgICAgICAgICByZXN1bHQucHVzaCgnICcpCiAgICAgICAgICBjdXJyZW50X3dpZHRoKysKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnB1c2gobW92ZXNbaV0pCiAgICAgICAgY3VycmVudF93aWR0aCArPSBtb3Zlc1tpXS5sZW5ndGgKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcnKQogICAgfSwKCiAgICBsb2FkX3BnbjogZnVuY3Rpb24gKHBnbiwgb3B0aW9ucykgewogICAgICAvLyBhbGxvdyB0aGUgdXNlciB0byBzcGVjaWZ5IHRoZSBzbG9wcHkgbW92ZSBwYXJzZXIgdG8gd29yayBhcm91bmQgb3ZlcgogICAgICAvLyBkaXNhbWJpZ3VhdGlvbiBidWdzIGluIEZyaXR6IGFuZCBDaGVzc2Jhc2UKICAgICAgdmFyIHNsb3BweSA9CiAgICAgICAgdHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmICdzbG9wcHknIGluIG9wdGlvbnMKICAgICAgICAgID8gb3B0aW9ucy5zbG9wcHkKICAgICAgICAgIDogZmFsc2UKCiAgICAgIGZ1bmN0aW9uIG1hc2soc3RyKSB7CiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9cXC9nLCAnXFwnKQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZV9wZ25faGVhZGVyKGhlYWRlciwgb3B0aW9ucykgewogICAgICAgIHZhciBuZXdsaW5lX2NoYXIgPQogICAgICAgICAgdHlwZW9mIG9wdGlvbnMgPT09ICdvYmplY3QnICYmCiAgICAgICAgICB0eXBlb2Ygb3B0aW9ucy5uZXdsaW5lX2NoYXIgPT09ICdzdHJpbmcnCiAgICAgICAgICAgID8gb3B0aW9ucy5uZXdsaW5lX2NoYXIKICAgICAgICAgICAgOiAnXHI/XG4nCiAgICAgICAgdmFyIGhlYWRlcl9vYmogPSB7fQogICAgICAgIHZhciBoZWFkZXJzID0gaGVhZGVyLnNwbGl0KG5ldyBSZWdFeHAobWFzayhuZXdsaW5lX2NoYXIpKSkKICAgICAgICB2YXIga2V5ID0gJycKICAgICAgICB2YXIgdmFsdWUgPSAnJwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciByZWdleCA9IC9eXHMqXFsoW0EtWmEtel0rKVxzKiIoLiopIlxzKlxdXHMqJC8KICAgICAgICAgIGtleSA9IGhlYWRlcnNbaV0ucmVwbGFjZShyZWdleCwgJyQxJykKICAgICAgICAgIHZhbHVlID0gaGVhZGVyc1tpXS5yZXBsYWNlKHJlZ2V4LCAnJDInKQogICAgICAgICAgaWYgKHRyaW0oa2V5KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGhlYWRlcl9vYmpba2V5XSA9IHZhbHVlCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaGVhZGVyX29iagogICAgICB9CgogICAgICAvLyBzdHJpcCB3aGl0ZXNwYWNlIGZyb20gaGVhZC90YWlsIG9mIFBHTiBibG9jawogICAgICBwZ24gPSBwZ24udHJpbSgpCgogICAgICB2YXIgbmV3bGluZV9jaGFyID0KICAgICAgICB0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG9wdGlvbnMubmV3bGluZV9jaGFyID09PSAnc3RyaW5nJwogICAgICAgICAgPyBvcHRpb25zLm5ld2xpbmVfY2hhcgogICAgICAgICAgOiAnXHI/XG4nCgogICAgICAvLyBSZWdFeHAgdG8gc3BsaXQgaGVhZGVyLiBUYWtlcyBhZHZhbnRhZ2Ugb2YgdGhlIGZhY3QgdGhhdCBoZWFkZXIgYW5kIG1vdmV0ZXh0CiAgICAgIC8vIHdpbGwgYWx3YXlzIGhhdmUgYSBibGFuayBsaW5lIGJldHdlZW4gdGhlbSAoaWUsIHR3byBuZXdsaW5lX2NoYXIncykuCiAgICAgIC8vIFdpdGggZGVmYXVsdCBuZXdsaW5lX2NoYXIsIHdpbGwgZXF1YWw6IC9eKFxbKCg/OlxyP1xuKXwuKSpcXSkoPzpccypccj9cbil7Mn0vCiAgICAgIHZhciBoZWFkZXJfcmVnZXggPSBuZXcgUmVnRXhwKAogICAgICAgICdeKFxcWygoPzonICsKICAgICAgICAgIG1hc2sobmV3bGluZV9jaGFyKSArCiAgICAgICAgICAnKXwuKSpcXF0pJyArCiAgICAgICAgICAnKD86XFxzKicgKwogICAgICAgICAgbWFzayhuZXdsaW5lX2NoYXIpICsKICAgICAgICAgICcpezJ9JwogICAgICApCgogICAgICAvLyBJZiBubyBoZWFkZXIgZ2l2ZW4sIGJlZ2luIHdpdGggbW92ZXMuCiAgICAgIHZhciBoZWFkZXJfc3RyaW5nID0gaGVhZGVyX3JlZ2V4LnRlc3QocGduKQogICAgICAgID8gaGVhZGVyX3JlZ2V4LmV4ZWMocGduKVsxXQogICAgICAgIDogJycKCiAgICAgIC8vIFB1dCB0aGUgYm9hcmQgaW4gdGhlIHN0YXJ0aW5nIHBvc2l0aW9uCiAgICAgIHJlc2V0KCkKCiAgICAgIC8qIHBhcnNlIFBHTiBoZWFkZXIgKi8KICAgICAgdmFyIGhlYWRlcnMgPSBwYXJzZV9wZ25faGVhZGVyKGhlYWRlcl9zdHJpbmcsIG9wdGlvbnMpCiAgICAgIHZhciBmZW4gPSAnJwoKICAgICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHsKICAgICAgICAvLyBjaGVjayB0byBzZWUgdXNlciBpcyBpbmNsdWRpbmcgZmVuIChwb3NzaWJseSB3aXRoIHdyb25nIHRhZyBjYXNlKQogICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ2ZlbicpIHsKICAgICAgICAgIGZlbiA9IGhlYWRlcnNba2V5XQogICAgICAgIH0KICAgICAgICBzZXRfaGVhZGVyKFtrZXksIGhlYWRlcnNba2V5XV0pCiAgICAgIH0KCiAgICAgIC8qIHNsb3BweSBwYXJzZXIgc2hvdWxkIGF0dGVtcHQgdG8gbG9hZCBhIGZlbiB0YWcsIGV2ZW4gaWYgaXQncwogICAgICAgKiB0aGUgd3JvbmcgY2FzZSBhbmQgZG9lc24ndCBpbmNsdWRlIGEgY29ycmVzcG9uZGluZyBbU2V0VXAgIjEiXSB0YWcgKi8KICAgICAgaWYgKHNsb3BweSkgewogICAgICAgIGlmIChmZW4pIHsKICAgICAgICAgIGlmICghbG9hZChmZW4sIHRydWUpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBzdHJpY3QgcGFyc2VyIC0gbG9hZCB0aGUgc3RhcnRpbmcgcG9zaXRpb24gaW5kaWNhdGVkIGJ5IFtTZXR1cCAnMSddCiAgICAgICAgICogYW5kIFtGRU4gcG9zaXRpb25dICovCiAgICAgICAgaWYgKGhlYWRlcnNbJ1NldFVwJ10gPT09ICcxJykgewogICAgICAgICAgaWYgKCEoJ0ZFTicgaW4gaGVhZGVycyAmJiBsb2FkKGhlYWRlcnNbJ0ZFTiddLCB0cnVlKSkpIHsKICAgICAgICAgICAgLy8gc2Vjb25kIGFyZ3VtZW50IHRvIGxvYWQ6IGRvbid0IGNsZWFyIHRoZSBoZWFkZXJzCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogTkI6IHRoZSByZWdleGVzIGJlbG93IHRoYXQgZGVsZXRlIG1vdmUgbnVtYmVycywgcmVjdXJzaXZlCiAgICAgICAqIGFubm90YXRpb25zLCBhbmQgbnVtZXJpYyBhbm5vdGF0aW9uIGdseXBocyBtYXkgYWxzbyBtYXRjaAogICAgICAgKiB0ZXh0IGluIGNvbW1lbnRzLiBUbyBwcmV2ZW50IHRoaXMsIHdlIHRyYW5zZm9ybSBjb21tZW50cwogICAgICAgKiBieSBoZXgtZW5jb2RpbmcgdGhlbSBpbiBwbGFjZSBhbmQgZGVjb2RpbmcgdGhlbSBhZ2FpbiBhZnRlcgogICAgICAgKiB0aGUgb3RoZXIgdG9rZW5zIGhhdmUgYmVlbiBkZWxldGVkLgogICAgICAgKgogICAgICAgKiBXaGlsZSB0aGUgc3BlYyBzdGF0ZXMgdGhhdCBQR04gZmlsZXMgc2hvdWxkIGJlIEFTQ0lJIGVuY29kZWQsCiAgICAgICAqIHdlIHVzZSB7ZW4sZGV9Y29kZVVSSUNvbXBvbmVudCBoZXJlIHRvIHN1cHBvcnQgYXJiaXRyYXJ5IFVURjgKICAgICAgICogYXMgYSBjb252ZW5pZW5jZSBmb3IgbW9kZXJuIHVzZXJzICovCgogICAgICB2YXIgdG9faGV4ID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0cmluZykKICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgLyogZW5jb2RlVVJJIGRvZXNuJ3QgdHJhbnNmb3JtIG1vc3QgQVNDSUkgY2hhcmFjdGVycywKICAgICAgICAgICAgICogc28gd2UgaGFuZGxlIHRoZXNlIG91cnNlbHZlcyAqLwogICAgICAgICAgICByZXR1cm4gYy5jaGFyQ29kZUF0KDApIDwgMTI4CiAgICAgICAgICAgICAgPyBjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpCiAgICAgICAgICAgICAgOiBlbmNvZGVVUklDb21wb25lbnQoYykucmVwbGFjZSgvXCUvZywgJycpLnRvTG93ZXJDYXNlKCkKICAgICAgICAgIH0pCiAgICAgICAgICAuam9pbignJykKICAgICAgfQoKICAgICAgdmFyIGZyb21faGV4ID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoID09IDAKICAgICAgICAgID8gJycKICAgICAgICAgIDogZGVjb2RlVVJJQ29tcG9uZW50KCclJyArIHN0cmluZy5tYXRjaCgvLnsxLDJ9L2cpLmpvaW4oJyUnKSkKICAgICAgfQoKICAgICAgdmFyIGVuY29kZV9jb21tZW50ID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKG5ldyBSZWdFeHAobWFzayhuZXdsaW5lX2NoYXIpLCAnZycpLCAnICcpCiAgICAgICAgcmV0dXJuIGB7JHt0b19oZXgoc3RyaW5nLnNsaWNlKDEsIHN0cmluZy5sZW5ndGggLSAxKSl9fWAKICAgICAgfQoKICAgICAgdmFyIGRlY29kZV9jb21tZW50ID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIGlmIChzdHJpbmcuc3RhcnRzV2l0aCgneycpICYmIHN0cmluZy5lbmRzV2l0aCgnfScpKSB7CiAgICAgICAgICByZXR1cm4gZnJvbV9oZXgoc3RyaW5nLnNsaWNlKDEsIHN0cmluZy5sZW5ndGggLSAxKSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8qIGRlbGV0ZSBoZWFkZXIgdG8gZ2V0IHRoZSBtb3ZlcyAqLwogICAgICB2YXIgbXMgPSBwZ24KICAgICAgICAucmVwbGFjZShoZWFkZXJfc3RyaW5nLCAnJykKICAgICAgICAucmVwbGFjZSgKICAgICAgICAgIC8qIGVuY29kZSBjb21tZW50cyBzbyB0aGV5IGRvbid0IGdldCBkZWxldGVkIGJlbG93ICovCiAgICAgICAgICBuZXcgUmVnRXhwKGAoXHtbXn1dKlx9KSs/fDsoW14ke21hc2sobmV3bGluZV9jaGFyKX1dKilgLCAnZycpLAogICAgICAgICAgZnVuY3Rpb24gKG1hdGNoLCBicmFja2V0LCBzZW1pY29sb24pIHsKICAgICAgICAgICAgcmV0dXJuIGJyYWNrZXQgIT09IHVuZGVmaW5lZAogICAgICAgICAgICAgID8gZW5jb2RlX2NvbW1lbnQoYnJhY2tldCkKICAgICAgICAgICAgICA6ICcgJyArIGVuY29kZV9jb21tZW50KGB7JHtzZW1pY29sb24uc2xpY2UoMSl9fWApCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAobWFzayhuZXdsaW5lX2NoYXIpLCAnZycpLCAnICcpCgogICAgICAvKiBkZWxldGUgcmVjdXJzaXZlIGFubm90YXRpb24gdmFyaWF0aW9ucyAqLwogICAgICB2YXIgcmF2X3JlZ2V4ID0gLyhcKFteXChcKV0rXCkpKz8vZwogICAgICB3aGlsZSAocmF2X3JlZ2V4LnRlc3QobXMpKSB7CiAgICAgICAgbXMgPSBtcy5yZXBsYWNlKHJhdl9yZWdleCwgJycpCiAgICAgIH0KCiAgICAgIC8qIGRlbGV0ZSBtb3ZlIG51bWJlcnMgKi8KICAgICAgbXMgPSBtcy5yZXBsYWNlKC9cZCtcLihcLlwuKT8vZywgJycpCgogICAgICAvKiBkZWxldGUgLi4uIGluZGljYXRpbmcgYmxhY2sgdG8gbW92ZSAqLwogICAgICBtcyA9IG1zLnJlcGxhY2UoL1wuXC5cLi9nLCAnJykKCiAgICAgIC8qIGRlbGV0ZSBudW1lcmljIGFubm90YXRpb24gZ2x5cGhzICovCiAgICAgIG1zID0gbXMucmVwbGFjZSgvXCRcZCsvZywgJycpCgogICAgICAvKiB0cmltIGFuZCBnZXQgYXJyYXkgb2YgbW92ZXMgKi8KICAgICAgdmFyIG1vdmVzID0gdHJpbShtcykuc3BsaXQobmV3IFJlZ0V4cCgvXHMrLykpCgogICAgICAvKiBkZWxldGUgZW1wdHkgZW50cmllcyAqLwogICAgICBtb3ZlcyA9IG1vdmVzLmpvaW4oJywnKS5yZXBsYWNlKC8sLCsvZywgJywnKS5zcGxpdCgnLCcpCiAgICAgIHZhciBtb3ZlID0gJycKCiAgICAgIHZhciByZXN1bHQgPSAnJwoKICAgICAgZm9yICh2YXIgaGFsZl9tb3ZlID0gMDsgaGFsZl9tb3ZlIDwgbW92ZXMubGVuZ3RoOyBoYWxmX21vdmUrKykgewogICAgICAgIHZhciBjb21tZW50ID0gZGVjb2RlX2NvbW1lbnQobW92ZXNbaGFsZl9tb3ZlXSkKICAgICAgICBpZiAoY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb21tZW50c1tnZW5lcmF0ZV9mZW4oKV0gPSBjb21tZW50CiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgbW92ZSA9IG1vdmVfZnJvbV9zYW4obW92ZXNbaGFsZl9tb3ZlXSwgc2xvcHB5KQoKICAgICAgICAvKiBpbnZhbGlkIG1vdmUgKi8KICAgICAgICBpZiAobW92ZSA9PSBudWxsKSB7CiAgICAgICAgICAvKiB3YXMgdGhlIG1vdmUgYW4gZW5kIG9mIGdhbWUgbWFya2VyICovCiAgICAgICAgICBpZiAoVEVSTUlOQVRJT05fTUFSS0VSUy5pbmRleE9mKG1vdmVzW2hhbGZfbW92ZV0pID4gLTEpIHsKICAgICAgICAgICAgcmVzdWx0ID0gbW92ZXNbaGFsZl9tb3ZlXQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8qIHJlc2V0IHRoZSBlbmQgb2YgZ2FtZSBtYXJrZXIgaWYgbWFraW5nIGEgdmFsaWQgbW92ZSAqLwogICAgICAgICAgcmVzdWx0ID0gJycKICAgICAgICAgIG1ha2VfbW92ZShtb3ZlKQogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogUGVyIHNlY3Rpb24gOC4yLjYgb2YgdGhlIFBHTiBzcGVjLCB0aGUgUmVzdWx0IHRhZyBwYWlyIG11c3QgbWF0Y2gKICAgICAgICogbWF0Y2ggdGhlIHRlcm1pbmF0aW9uIG1hcmtlci4gT25seSBkbyB0aGlzIHdoZW4gaGVhZGVycyBhcmUgcHJlc2VudCwKICAgICAgICogYnV0IHRoZSByZXN1bHQgdGFnIGlzIG1pc3NpbmcKICAgICAgICovCiAgICAgIGlmIChyZXN1bHQgJiYgT2JqZWN0LmtleXMoaGVhZGVyKS5sZW5ndGggJiYgIWhlYWRlclsnUmVzdWx0J10pIHsKICAgICAgICBzZXRfaGVhZGVyKFsnUmVzdWx0JywgcmVzdWx0XSkKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWUKICAgIH0sCgogICAgaGVhZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBzZXRfaGVhZGVyKGFyZ3VtZW50cykKICAgIH0sCgogICAgdHVybjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdHVybgogICAgfSwKCiAgICBtb3ZlOiBmdW5jdGlvbiAobW92ZSwgb3B0aW9ucykgewogICAgICAvKiBUaGUgbW92ZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHdpdGggaW4gdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgogICAgICAgKgogICAgICAgKiAubW92ZSgnTnhiNycpICAgICAgPC0gd2hlcmUgJ21vdmUnIGlzIGEgY2FzZS1zZW5zaXRpdmUgU0FOIHN0cmluZwogICAgICAgKgogICAgICAgKiAubW92ZSh7IGZyb206ICdoNycsIDwtIHdoZXJlIHRoZSAnbW92ZScgaXMgYSBtb3ZlIG9iamVjdCAoYWRkaXRpb25hbAogICAgICAgKiAgICAgICAgIHRvIDonaDgnLCAgICAgIGZpZWxkcyBhcmUgaWdub3JlZCkKICAgICAgICogICAgICAgICBwcm9tb3Rpb246ICdxJywKICAgICAgICogICAgICB9KQogICAgICAgKi8KCiAgICAgIC8vIGFsbG93IHRoZSB1c2VyIHRvIHNwZWNpZnkgdGhlIHNsb3BweSBtb3ZlIHBhcnNlciB0byB3b3JrIGFyb3VuZCBvdmVyCiAgICAgIC8vIGRpc2FtYmlndWF0aW9uIGJ1Z3MgaW4gRnJpdHogYW5kIENoZXNzYmFzZQogICAgICB2YXIgc2xvcHB5ID0KICAgICAgICB0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYgJ3Nsb3BweScgaW4gb3B0aW9ucwogICAgICAgICAgPyBvcHRpb25zLnNsb3BweQogICAgICAgICAgOiBmYWxzZQoKICAgICAgdmFyIG1vdmVfb2JqID0gbnVsbAoKICAgICAgaWYgKHR5cGVvZiBtb3ZlID09PSAnc3RyaW5nJykgewogICAgICAgIG1vdmVfb2JqID0gbW92ZV9mcm9tX3Nhbihtb3ZlLCBzbG9wcHkpCiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vdmUgPT09ICdvYmplY3QnKSB7CiAgICAgICAgdmFyIG1vdmVzID0gZ2VuZXJhdGVfbW92ZXMoKQoKICAgICAgICAvKiBjb252ZXJ0IHRoZSBwcmV0dHkgbW92ZSBvYmplY3QgdG8gYW4gdWdseSBtb3ZlIG9iamVjdCAqLwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBtb3Zlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgICBtb3ZlLmZyb20gPT09IGFsZ2VicmFpYyhtb3Zlc1tpXS5mcm9tKSAmJgogICAgICAgICAgICBtb3ZlLnRvID09PSBhbGdlYnJhaWMobW92ZXNbaV0udG8pICYmCiAgICAgICAgICAgICghKCdwcm9tb3Rpb24nIGluIG1vdmVzW2ldKSB8fAogICAgICAgICAgICAgIG1vdmUucHJvbW90aW9uID09PSBtb3Zlc1tpXS5wcm9tb3Rpb24pCiAgICAgICAgICApIHsKICAgICAgICAgICAgbW92ZV9vYmogPSBtb3Zlc1tpXQogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogZmFpbGVkIHRvIGZpbmQgbW92ZSAqLwogICAgICBpZiAoIW1vdmVfb2JqKSB7CiAgICAgICAgcmV0dXJuIG51bGwKICAgICAgfQoKICAgICAgLyogbmVlZCB0byBtYWtlIGEgY29weSBvZiBtb3ZlIGJlY2F1c2Ugd2UgY2FuJ3QgZ2VuZXJhdGUgU0FOIGFmdGVyIHRoZQogICAgICAgKiBtb3ZlIGlzIG1hZGUKICAgICAgICovCiAgICAgIHZhciBwcmV0dHlfbW92ZSA9IG1ha2VfcHJldHR5KG1vdmVfb2JqKQoKICAgICAgbWFrZV9tb3ZlKG1vdmVfb2JqKQoKICAgICAgcmV0dXJuIHByZXR0eV9tb3ZlCiAgICB9LAoKICAgIHVuZG86IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG1vdmUgPSB1bmRvX21vdmUoKQogICAgICByZXR1cm4gbW92ZSA/IG1ha2VfcHJldHR5KG1vdmUpIDogbnVsbAogICAgfSwKCiAgICBjbGVhcjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gY2xlYXIoKQogICAgfSwKCiAgICBwdXQ6IGZ1bmN0aW9uIChwaWVjZSwgc3F1YXJlKSB7CiAgICAgIHJldHVybiBwdXQocGllY2UsIHNxdWFyZSkKICAgIH0sCgogICAgZ2V0OiBmdW5jdGlvbiAoc3F1YXJlKSB7CiAgICAgIHJldHVybiBnZXQoc3F1YXJlKQogICAgfSwKCiAgICBhc2NpaSgpIHsKICAgICAgdmFyIHMgPSAnICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbicKICAgICAgZm9yICh2YXIgaSA9IFNRVUFSRV9NQVAuYTg7IGkgPD0gU1FVQVJFX01BUC5oMTsgaSsrKSB7CiAgICAgICAgLyogZGlzcGxheSB0aGUgcmFuayAqLwogICAgICAgIGlmIChmaWxlKGkpID09PSAwKSB7CiAgICAgICAgICBzICs9ICcgJyArICc4NzY1NDMyMSdbcmFuayhpKV0gKyAnIHwnCiAgICAgICAgfQoKICAgICAgICAvKiBlbXB0eSBwaWVjZSAqLwogICAgICAgIGlmIChib2FyZFtpXSA9PSBudWxsKSB7CiAgICAgICAgICBzICs9ICcgLiAnCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBwaWVjZSA9IGJvYXJkW2ldLnR5cGUKICAgICAgICAgIHZhciBjb2xvciA9IGJvYXJkW2ldLmNvbG9yCiAgICAgICAgICB2YXIgc3ltYm9sID0KICAgICAgICAgICAgY29sb3IgPT09IFdISVRFID8gcGllY2UudG9VcHBlckNhc2UoKSA6IHBpZWNlLnRvTG93ZXJDYXNlKCkKICAgICAgICAgIHMgKz0gJyAnICsgc3ltYm9sICsgJyAnCiAgICAgICAgfQoKICAgICAgICBpZiAoKGkgKyAxKSAmIDB4ODgpIHsKICAgICAgICAgIHMgKz0gJ3xcbicKICAgICAgICAgIGkgKz0gOAogICAgICAgIH0KICAgICAgfQogICAgICBzICs9ICcgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuJwogICAgICBzICs9ICcgICAgIGEgIGIgIGMgIGQgIGUgIGYgIGcgIGgnCgogICAgICByZXR1cm4gcwogICAgfSwKCiAgICByZW1vdmU6IGZ1bmN0aW9uIChzcXVhcmUpIHsKICAgICAgcmV0dXJuIHJlbW92ZShzcXVhcmUpCiAgICB9LAoKICAgIHBlcmZ0OiBmdW5jdGlvbiAoZGVwdGgpIHsKICAgICAgcmV0dXJuIHBlcmZ0KGRlcHRoKQogICAgfSwKCiAgICBzcXVhcmVfY29sb3I6IGZ1bmN0aW9uIChzcXVhcmUpIHsKICAgICAgaWYgKHNxdWFyZSBpbiBTUVVBUkVfTUFQKSB7CiAgICAgICAgdmFyIHNxXzB4ODggPSBTUVVBUkVfTUFQW3NxdWFyZV0KICAgICAgICByZXR1cm4gKHJhbmsoc3FfMHg4OCkgKyBmaWxlKHNxXzB4ODgpKSAlIDIgPT09IDAgPyAnbGlnaHQnIDogJ2RhcmsnCiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsCiAgICB9LAoKICAgIGhpc3Rvcnk6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHZhciByZXZlcnNlZF9oaXN0b3J5ID0gW10KICAgICAgdmFyIG1vdmVfaGlzdG9yeSA9IFtdCiAgICAgIHZhciB2ZXJib3NlID0KICAgICAgICB0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYKICAgICAgICAndmVyYm9zZScgaW4gb3B0aW9ucyAmJgogICAgICAgIG9wdGlvbnMudmVyYm9zZQoKICAgICAgd2hpbGUgKGhpc3RvcnkubGVuZ3RoID4gMCkgewogICAgICAgIHJldmVyc2VkX2hpc3RvcnkucHVzaCh1bmRvX21vdmUoKSkKICAgICAgfQoKICAgICAgd2hpbGUgKHJldmVyc2VkX2hpc3RvcnkubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBtb3ZlID0gcmV2ZXJzZWRfaGlzdG9yeS5wb3AoKQogICAgICAgIGlmICh2ZXJib3NlKSB7CiAgICAgICAgICBtb3ZlX2hpc3RvcnkucHVzaChtYWtlX3ByZXR0eShtb3ZlKSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW92ZV9oaXN0b3J5LnB1c2gobW92ZV90b19zYW4obW92ZSwgZ2VuZXJhdGVfbW92ZXMoeyBsZWdhbDogdHJ1ZSB9KSkpCiAgICAgICAgfQogICAgICAgIG1ha2VfbW92ZShtb3ZlKQogICAgICB9CgogICAgICByZXR1cm4gbW92ZV9oaXN0b3J5CiAgICB9LAoKICAgIGdldF9jb21tZW50OiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjb21tZW50c1tnZW5lcmF0ZV9mZW4oKV0KICAgIH0sCgogICAgc2V0X2NvbW1lbnQ6IGZ1bmN0aW9uIChjb21tZW50KSB7CiAgICAgIGNvbW1lbnRzW2dlbmVyYXRlX2ZlbigpXSA9IGNvbW1lbnQucmVwbGFjZSgneycsICdbJykucmVwbGFjZSgnfScsICddJykKICAgIH0sCgogICAgZGVsZXRlX2NvbW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGNvbW1lbnQgPSBjb21tZW50c1tnZW5lcmF0ZV9mZW4oKV0KICAgICAgZGVsZXRlIGNvbW1lbnRzW2dlbmVyYXRlX2ZlbigpXQogICAgICByZXR1cm4gY29tbWVudAogICAgfSwKCiAgICBnZXRfY29tbWVudHM6IGZ1bmN0aW9uICgpIHsKICAgICAgcHJ1bmVfY29tbWVudHMoKQogICAgICByZXR1cm4gT2JqZWN0LmtleXMoY29tbWVudHMpLm1hcChmdW5jdGlvbiAoZmVuKSB7CiAgICAgICAgcmV0dXJuIHsgZmVuOiBmZW4sIGNvbW1lbnQ6IGNvbW1lbnRzW2Zlbl0gfQogICAgICB9KQogICAgfSwKCiAgICBkZWxldGVfY29tbWVudHM6IGZ1bmN0aW9uICgpIHsKICAgICAgcHJ1bmVfY29tbWVudHMoKQogICAgICByZXR1cm4gT2JqZWN0LmtleXMoY29tbWVudHMpLm1hcChmdW5jdGlvbiAoZmVuKSB7CiAgICAgICAgdmFyIGNvbW1lbnQgPSBjb21tZW50c1tmZW5dCiAgICAgICAgZGVsZXRlIGNvbW1lbnRzW2Zlbl0KICAgICAgICByZXR1cm4geyBmZW46IGZlbiwgY29tbWVudDogY29tbWVudCB9CiAgICAgIH0pCiAgICB9LAogIH0KfQo="></script>
<script src="data:text/javascript;base64,Y29uc3QgR2FtZSA9IGZ1bmN0aW9uICgpIHsKICAvLyB1c2VmdWwgY29uc3RhbnRzCiAgY29uc3QgQSA9ICdhJywKICAgICAgICBCID0gJ2InLAogICAgICAgIEMgPSAnYycsCiAgICAgICAgRCA9ICdkJywKICAgICAgICBFID0gJ2UnLAogICAgICAgIEYgPSAnZicsCiAgICAgICAgRyA9ICdnJywKICAgICAgICBIID0gJ2gnOwoKICBjb25zdCByYW5rcyA9IFsxLDIsMyw0LDUsNiw3LDhdOwogIGNvbnN0IGZpbGVzID0gW0EsQixDLEQsRSxGLEcsSF07CgogIC8vIHRyYWNrIHNxdWFyZXMgaGF2ZSBiZWVuIHNlbGVjdGVkCiAgLy8gdXNlZCB0byBpbnB1dCBtb3ZlcyBhbmQgbGlnaHQgcmFuayBhbmQgZmlsZSBpbmRpY2F0b3JzCiAgbGV0IHRhcHBlZCA9IFtdOwoKICAvLyBpbml0aWFsaXplIGludGVybmFsIGJvYXJkIEFQSQogIGNvbnN0IGJvYXJkID0gbmV3IENoZXNzKCk7CgogIC8vIGluaXRpYWxpemUgQUkKICBhaSA9IG5ldyBBSSgpOwogIGFpLlcuZGlzYWJsZWQgPSB0cnVlOwogIGFpLmluaXQoKTsKCiAgLy8gc2VuZCBtb3ZlIHRvIEFJCiAgY29uc3Qgc2VuZE1vdmVUb0FJID0gKGZyb20sIHRvKSA9PiB7CiAgICBhaS5tYWtlTW92ZSh0YXBwZWRbMF0sIHRhcHBlZFsxXSwgKGFpKSA9PiB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRhcHBlZCA9IFthaS5mcm9tXTsKICAgICAgICByZW5kZXIoKTsKICAgICAgICBsaWdodCh0YXBwZWQpCiAgICAgIH0sIDApOwoKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgYm9hcmQubW92ZSh7IGZyb206IGFpLmZyb20sIHRvOiBhaS50bywgcHJvbW90aW9uOiAncScgfSk7CiAgICAgICAgdGFwcGVkID0gW2FpLmZyb20sIGFpLnRvXTsKICAgICAgICByZW5kZXIoKTsKICAgICAgICBsaWdodCh0YXBwZWQpCiAgICAgIH0sIDUwMCk7CiAgICB9KTsKICB9CgogIC8vIG1haW4gaW5wdXQgaW50ZXJmYWNlCiAgY29uc3QgdGFwID0gKGV2KSA9PiB7CiAgICBjb25zdCBzcXVhcmUgPSBldi50YXJnZXQuaWQ7IC8vICdlMicKICAgIGNvbnN0IG1vdmVhYmxlUGllY2UgPSBib2FyZC5tb3Zlcyh7IHNxdWFyZTogc3F1YXJlIH0pLmxlbmd0aCA+IDA7CiAgICBjb25zdCBsZWdhbE1vdmUgPSBib2FyZC5tb3ZlKHsgZnJvbTogdGFwcGVkWzBdLCB0bzogc3F1YXJlLCBwcm9tb3Rpb246ICdxJyB9KTsKCiAgICBpZiAobGVnYWxNb3ZlKSB7CiAgICAgIHRhcHBlZC5wdXNoKHNxdWFyZSk7CiAgICAgIHJlbmRlcigpOwogICAgICBzZW5kTW92ZVRvQUkodGFwcGVkWzBdLCB0YXBwZWRbMV0pOyAgICAgIAogICAgfSBlbHNlIGlmIChtb3ZlYWJsZVBpZWNlKSB7CiAgICAgIHRhcHBlZCA9IFtzcXVhcmVdOwogICAgfSBlbHNlIHsKICAgICAgdGFwcGVkID0gW107CiAgICB9CgogICAgbGlnaHQodGFwcGVkKTsKICB9CgogIC8vIGluaXRpYWxpemUgb25jbGljayBldmVudHMKICBjb25zdCBzcXVhcmVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncycpOwogIGZvciAobGV0IHNxdWFyZSBvZiBzcXVhcmVzKSB7CiAgICBzcXVhcmUub25jbGljayA9IHRhcDsKICB9CgogIC8vIGxpZ2h0IHRoZSByYW5rIGFuZCBmaWxlIGluZGljYXRvcnMgb2YgdGhlIHNlbGVjdGVkIHNxdWFyZXMKICBjb25zdCBsaWdodCA9IChzcXVhcmVzKSA9PiB7CiAgICBjb25zdCBpbmRpY2F0b3JzID0gWydmJywgJ3InXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB0eXBlID0gaW5kaWNhdG9yc1tpXTsgLy8gJ3InIG9yICdmJwogICAgICBjb25zdCByb3dzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0eXBlKTsKCiAgICAgIGZvciAobGV0IHJvdyBvZiByb3dzKSB7CiAgICAgICAgbGV0IGxpdCA9IGZhbHNlOwoKICAgICAgICBmb3IgKGxldCBzcXVhcmUgb2Ygc3F1YXJlcykgewogICAgICAgICAgaWYgKHJvdy5pZFsxXSA9PT0gc3F1YXJlW2ldKSB7IGxpdCA9IHRydWU7IH0KICAgICAgICB9CgogICAgICAgIHJvdy5jbGFzc0xpc3QudG9nZ2xlKCdsaXQnLCBsaXQpCiAgICAgIH0KICAgIH0KICB9CgogIGNvbnN0IHJlbmRlciA9ICgpID0+IHsKICAgIGZvciAobGV0IHJhbmsgb2YgcmFua3MpIHsKICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykgewogICAgICAgIGNvbnN0IGlkID0gZmlsZSArIHJhbms7IC8vICdlMicKICAgICAgICBjb25zdCBzcXVhcmUgPSBib2FyZC5nZXQoaWQpOwogICAgICAgIGxldCBwaWVjZSA9IHNxdWFyZSA/IHNxdWFyZS5jb2xvciArIHNxdWFyZS50eXBlIDogJyc7IC8vICd3cCcKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc2V0QXR0cmlidXRlKCdjbGFzcycsIGAke3BpZWNlfSBzYCk7CiAgICAgIH0KICAgIH0KCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hlY2snKS5jbGFzc0xpc3QudG9nZ2xlKCdsaXQnLCBib2FyZC5pbl9jaGVjaygpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRlJykuY2xhc3NMaXN0LnRvZ2dsZSgnbGl0JywgYm9hcmQuaW5fY2hlY2ttYXRlKCkpOwogIH0KCiAgcmV0dXJuIHsKICAgIHJlbmRlcjogcmVuZGVyLAogICAgYm9hcmQ6IGJvYXJkLAogIH0KfQo="></script>
<script src="data:text/javascript;base64,Ly8gSmF2YXNjcmlwdCBjaGVzcyBlbmdpbmUgKGMpMjAxMSBPc2NhciBUb2xlZG8gRy4KY29uc3QgQUkgPSBmdW5jdGlvbiAoKSB7CgogIHZhciBCLCBpLCB5LCB1LCBiLCBJLCBHLCB4LCB6LCBNLCBsOwoKICBsZXQgZXhwb3J0cyA9IHt9OwoKICBjb25zdCBYID0gKHcsIGMsIGgsIGUsIFMsIHMpID0+IHsKICAgIHZhciB0LCBvLCBMLCBFLCBkLCBPID0gZSwKICAgICAgICBOID0gLU0gKiBNLAogICAgICAgIEsgPSA3OCAtIGggPDwgeCwKICAgICAgICBwLCBnLCBuLCBtLCBBLCBxLCByLCBDLCBKLCBhID0geSA/IC14IDogeCwKICAgICAgICBmcm9tLCB0bzsKICAgIHkgXj0gODsKICAgIEcrKzsKICAgIGQgPSB3IHx8IHMgJiYgcyA+PSBoICYmIFgoMCwgMCwgMCwgMjEsIDAsIDApID4gTTsKICAgIGRvIHsKICAgICAgaWYgKG8gPSBJW3AgPSBPXSkgewogICAgICAgIHEgPSBvICYgeiBeIHk7CiAgICAgICAgaWYgKHEgPCA3KSB7CiAgICAgICAgICBBID0gcS0tICYgMiA/IDggOiA0OwogICAgICAgICAgQyA9IG8gLSA5ICYgeiA/IFs1MywgNDcsIDYxLCA1MSwgNDcsIDQ3XVtxXSA6IDU3OwogICAgICAgICAgZG8gewogICAgICAgICAgICByID0gSVtwICs9IGxbQ11dOwogICAgICAgICAgICBpZiAoIXcgfCBwID09IHcpIHsKICAgICAgICAgICAgICBnID0gcSB8IHAgKyBhIC0gUyA/IDAgOiBTOwogICAgICAgICAgICAgIGlmICghciAmICggISEgcSB8IEEgPCAzIHx8ICEhIGcpIHx8IChyICsgMSAmIHogXiB5KSA+IDkgJiYgcSB8IEEgPiAyKSB7CiAgICAgICAgICAgICAgICBpZiAobSA9ICEociAtIDIgJiA3KSkgcmV0dXJuIHkgXj0gOCwgSVtHLS1dID0gTywgSzsKICAgICAgICAgICAgICAgIEogPSBuID0gbyAmIHo7CiAgICAgICAgICAgICAgICBFID0gSVtwIC0gYV0gJiB6OwogICAgICAgICAgICAgICAgdCA9IHEgfCBFIC0gNyA/IG4gOiAobiArPSAyLCA2IF4geSk7CiAgICAgICAgICAgICAgICB3aGlsZSAobiA8PSB0KSB7CiAgICAgICAgICAgICAgICAgIEwgPSByID8gbFtyICYgNyB8IDMyXSAtIGggLSBxIDogMDsKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBzKSBMICs9ICgxIC0gcSA/IGxbKHAgLSBwICUgeCkgLyB4ICsgMzddIC0gbFsoTyAtIE8gJSB4KSAvIHggKyAzN10gKyBsW3AgJSB4ICsgMzhdICogKHEgPyAxIDogMikgLSBsW08gJSB4ICsgMzhdICsgKG8gJiAxNikgLyAyIDogISEgbSAqIDkpICsgKCFxID8gIShJW3AgLSAxXSBeIG4pICsgIShJW3AgKyAxXSBeIG4pICsgbFtuICYgNyB8IDMyXSAtIDk5ICsgISEgZyAqIDk5ICsgKEEgPCAyKSA6IDApICsgIShFIF4geSBeIDkpOwogICAgICAgICAgICAgICAgICBpZiAocyA+IGggfHwgMSA8IHMgJiBzID09IGggJiYgTCA+IHogfCBkKSB7CiAgICAgICAgICAgICAgICAgICAgSVtwXSA9IG4sIElbT10gPSBtID8gKElbZ10gPSBJW21dLCBJW21dID0gMCkgOiBnID8gSVtnXSA9IDAgOiAwOwogICAgICAgICAgICAgICAgICAgIEwgLT0gWChzID4gaCB8IGQgPyAwIDogcCwgTCAtIE4sIGggKyAxLCBJW0cgKyAxXSwgSiA9IHEgfCBBID4gMSA/IDAgOiBwLCBzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIShoIHx8IHMgLSAxIHwgQiAtIE8gfCBpIC0gbiB8IHAgLSBiIHwgTCA8IC1NKSl7CiAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLm1ha2VNb3ZlLmNhbGxiYWNrICYmICggZXhwb3J0cy5tYWtlTW92ZS5jYWxsYmFjayhPLHApLCAoIGV4cG9ydHMubWFrZU1vdmUuY2FsbGJhY2sgPSB1bmRlZmluZWQgKSApOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFcoKSwgRy0tLCB1ID0gSjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgSiA9IHEgLSAxIHwgQSA8IDcgfHwgbSB8fCAhcyB8IGQgfCByIHwgbyA8IHogfHwgWCgwLCAwLCAwLCAyMSwgMCwgMCkgPiBNOwogICAgICAgICAgICAgICAgICAgIElbT10gPSBvOwogICAgICAgICAgICAgICAgICAgIElbcF0gPSByOwogICAgICAgICAgICAgICAgICAgIG0gPyAoSVttXSA9IElbZ10sIElbZ10gPSAwKSA6IGcgPyBJW2ddID0gOSBeIHkgOiAwOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChMID4gTiB8fCBzID4gMSAmJiBMID09IE4gJiYgIWggJiYgTWF0aC5yYW5kb20oKSA8IC41KSB7CiAgICAgICAgICAgICAgICAgICAgSVtHXSA9IE87CiAgICAgICAgICAgICAgICAgICAgaWYgKHMgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaCAmJiBjIC0gTCA8IDApIHJldHVybiB5IF49IDgsIEctLSwgTDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghaCkgaSA9IG4sIEIgPSBPLCBiID0gcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgTiA9IEw7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbiArPSBKIHx8IChnID0gcCwgbSA9IHAgPCBPID8gZyAtIDMgOiBnICsgMiwgSVttXSA8IHogfCBJWwogICAgICAgICAgICAgICAgICBtICsgTyAtIHBdIHx8IElbcCArPSBwIC0gT10pID8gMSA6IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IHdoaWxlICghciAmIHEgPiAyIHx8IChwID0gTywgcSB8IEEgPiAyIHwgbyA+IHogJiAhciAmJiArK0MgKiAtLUEpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gd2hpbGUgKCsrTyA+IDk4ID8gTyA9IDIwIDogZSAtIE8pOwogICAgcmV0dXJuIHkgXj0gOCwgRy0tLCBOICsgTSAqIE0gJiYgTiA+IC1LICsgMTkyNCB8IGQgPyBOIDogMDsKICB9CgogIGNvbnN0IE8gPSAoKSA9PiB7CiAgICBCID0gaSA9IHkgPSB1ID0gMDsKICAgIHdoaWxlIChCKysgPCAxMjApIElbQiAtIDFdID0gQiAlIHggPyBCIC8geCAlIHggPCAyIHwgQiAlIHggPCAyID8gNyA6IEIgLyB4ICYgNCA/IDAgOiBsW2krK10gfCAxNiA6IDc7CiAgICBmb3IgKHZhciBhID0gIjx0YWJsZSBjZWxsc3BhY2luZz0wIGFsaWduPWNlbnRlciBib3JkZXI9MD4iLCBCID0gMDsgQiA8IDg7IEIrKykKICAgIGZvciAoYSArPSAiPHRyPiIsIGkgPSAyMTsgaSA8IDI5OyBpKyspIGEgKz0gIjx0ZCB3aWR0aD00MCBoZWlnaHQ9NDAgb25jbGljaz10b2xlZG9DaGVzcy5ZKCIgKyAoQiAqIHggKyBpKSArICIpIGlkPW8iICsgKEIgKiB4ICsgaSkgKyAiIHN0eWxlPSdib3JkZXI6MnB4IHNvbGlkICNlMGUwZjAnIGJnY29sb3I9IyIgKyAoaSArIEIgJiAxID8gImYwZiIgOiAiYzBjIikgKyAiMGYwIGFsaWduPWNlbnRlcj4iOwogICAgYSArPSAiPHRyPjx0ZCBjb2xzcGFuPTggYWxpZ249Y2VudGVyPjxzZWxlY3QgaWQ9dD48b3B0aW9uPlE8b3B0aW9uPlI8b3B0aW9uPkIiOwogICAgIVcuZGlzYWJsZWQgJiYgZG9jdW1lbnQud3JpdGUoYSArICI8b3B0aW9uPk48L3NlbGVjdD48L3RhYmxlPiIpOwogIH0KCiAgY29uc3QgVyA9ICgpID0+IHsKICAgIEIgPSBiOwoKICAgIGlmKFcuZGlzYWJsZWQpewogICAgICByZXR1cm47CiAgICB9CgogICAgZm9yICh2YXIgcCA9IDIxOyBwIDwgOTk7IHAgKz0gcCAlIHggLSA4ID8gMSA6IDMpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm8iICsgcCkuCiAgICAgIGlubmVySFRNTCA9ICJceGEwcGtuYnJxICBQS05CUlEiLmNoYXJBdChJW3BdICYgeik7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvIiArIHApLgogICAgICBzdHlsZS5ib3JkZXJDb2xvciA9IHAgPT0gQiA/ICJyZWQiIDogIiNlMGUwZjAiOwogICAgfQogIH0KCiAgLy8gcGxheSBmaXJzdCB0aHJlZSBtb3ZlcyBhdCByYW5kb20gc3RyZW5ndGggKDIgLSA0KSB0byBpbmNyZWFzZSBvcGVuaW5nIHZhcmlhYmlsaXR5LAogIC8vIHRoZW4gZml4IHN0cmVuZ3RoIHRvIGZvdXIgcGx5IGZvciByZW1haW5kZXIgb2YgZ2FtZS4KICBjb25zdCBzdGFydFN0cmVuZ3RoID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiAzfSwgKCkgPT4gMiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpKTsKICBsZXQgbW92ZU51bWJlciA9IDA7CiAgY29uc3QgcGx5ID0gKCkgPT4gewogICAgY29uc3QgcmVzdWx0ID0gc3RhcnRTdHJlbmd0aFttb3ZlTnVtYmVyXSB8fCA0OwogICAgbW92ZU51bWJlcisrOwogICAgY29uc29sZS5sb2coYHJlc3BvbmRpbmcgYXQgJHtyZXN1bHR9IHBseWApOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGNvbnN0IFkgPSAocykgPT4gewogICAgaSA9IChJW3NdIF4geSkgJiB6OwogICAgaWYgKGkgPiA4KSB7CiAgICAgIGIgPSBzOwogICAgICBXKCk7CiAgICB9IGVsc2UgaWYgKEIgJiYgaSA8IDkpIHsKICAgICAgYiA9IHM7CiAgICAgIGkgPSBJW0JdICYgejsKICAgICAgaWYgKChpICYgNykgPT0gMSAmIChiIDwgMjkgfCBiID4gOTApKSBpID0gMTQgLSAwIF4geTsKICAgICAgWCgwLCAwLCAwLCAyMSwgdSwgMSk7CiAgICAgIGlmICh5KXsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICBYKDAsMCwwLDIxLHUscGx5KCkvKnBseSovKTsKICAgICAgICAgIFgoMCwwLDAsMjEsdSwxKTsKICAgICAgICB9LDI1MCk7CiAgICAgICAgLy93aW5kb3cuc2V0VGltZW91dCgiWCgwLDAsMCwyMSx1LDIvKnBseSovKSxYKDAsMCwwLDIxLHUsMSkiLCAyNTApOwogICAgICB9CiAgICB9CiAgfQoKICBleHBvcnRzLm1ha2VNb3ZlID0gKGZ1bmN0aW9uKCl7CiAgICB2YXIgZmlsZXMgPSB7ICdhJzoxLCAnYic6MiwgJ2MnOjMsICdkJzo0LCAnZSc6NSwgJ2YnOjYsICdnJzo3LCAnaCc6OCB9LAogICAgICAgIGNhbGxiYWNrOwoKICAgIGZ1bmN0aW9uIF8oZnJvbSwgdG8sIGNhbGxiYWNrKXsKICAgICAgdmFyIGEgPSB0b0xvYyhmcm9tKSwKICAgICAgICAgIGIgPSB0b0xvYyh0byk7CgogICAgICBZKHRvTG9jKGZyb20pKTsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICBjYWxsYmFjayAmJiAoIF8uY2FsbGJhY2sgPSBmdW5jdGlvbihmcm9tLHRvKXsKICAgICAgICAgIGNhbGxiYWNrKHsgJ2Zyb20nOnRvU0FOKGZyb20pLCAndG8nOnRvU0FOKHRvKSB9KTsKICAgICAgICB9KTsKICAgICAgfSwwKTsKCiAgICAgIFkodG9Mb2ModG8pKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0xvYyhzYW4pewogICAgICB2YXIgcyA9IHNhbi5sZW5ndGggPT0gMyAmJiAxIHx8IDAsCiAgICAgICAgICBmID0gc2FuLmNoYXJDb2RlQXQocyktOTYsCiAgICAgICAgICByID0gMTAtcGFyc2VJbnQoc2FuLnN1YnN0cmluZyhzKzEscysyKSk7CgogICAgICByZXR1cm4gciArICcnICsgZjsKICAgIH0KCiAgICBmdW5jdGlvbiB0b1NBTihsb2MpewogICAgICB2YXIgciA9IDEwLU1hdGguZmxvb3IobG9jIC8gMTApLAogICAgICAgICAgZiA9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGxvYyAlIDEwKSs5Nik7CgogICAgICByZXR1cm4gZityOwogICAgfQoKICAgIHJldHVybiBfOwogIH0pKCk7CgogIGV4cG9ydHMuWCA9IFg7CiAgZXhwb3J0cy5ZID0gWTsKICBleHBvcnRzLlcgPSBXOwoKICBleHBvcnRzLmluaXQgPSBmdW5jdGlvbigpewoKICAgIGlmKCFXLmRpc2FibGVkICYmIGRvY3VtZW50LmJvZHkpewogICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnOwogICAgfQoKICAgIEIsIGksIHksIHUsIGIsIEkgPSBbXTsKCiAgICBHID0gMTIwOwogICAgeCA9IDEwOwogICAgeiA9IDE1OwogICAgTSA9IDFlNDsKICAgIGwgPSBbNSwgMywgNCwgNiwgMiwgNCwgMywgNSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgOSwgOSwgOSwgOSwgOSwgOSwgOSwgOSwgMTMsIDExLCAxMiwgMTQsIDEwLCAxMiwgMTEsIDEzLCAwLCA5OSwgMCwgMzA2LCAyOTcsIDQ5NSwgODQ2LCAtMSwgMCwgMSwgMiwgMiwgMSwgMCwgLTEsIC0xLCAxLCAtMTAsIDEwLCAtMTEsIC05LCA5LCAxMSwgMTAsIDIwLCAtOSwgLTExLCAtMTAsIC0yMCwgLTIxLCAtMTksIC0xMiwgLTgsIDgsIDEyLCAxOSwgMjFdOwoKICAgIE8oKTsKICAgIFcoKTsKICB9CgogIHJldHVybiBleHBvcnRzOwoKfQo="></script>
<style>/*!
 * Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */@font-face{font-family:chess;src:url(data:font/truetype;charset=utf-8;base64,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)format("truetype")}html,body{background-color:#222}body{margin:0;padding:36px 0}#board{width:100vmin;margin:auto}#board td{height:11.5vmin;width:11.5vmin;font-size:10vmin;line-height:10vmin;text-align:center}#board tr td{background-color:#696}#board tr:nth-child(odd) td:nth-child(even){background-color:#ADA}#board tr:nth-child(even) td:nth-child(odd){background-color:#ADA}#board .wr::after,#board .wn::after,#board .wb::after,#board .wq::after,#board .wk::after,#board .wp::after,#board .br::after,#board .bn::after,#board .bb::after,#board .bq::after,#board .bk::after,#board .bp::after{font-family:chess}#board .wr::after,#board .wn::after,#board .wb::after,#board .wq::after,#board .wk::after,#board .wp::after{color:#FFFFF0}#board .br::after,#board .bn::after,#board .bb::after,#board .bq::after,#board .bk::after,#board .bp::after{color:#222}#board .wr::after,#board .br::after{content:""}#board .wn::after,#board .bn::after{content:""}#board .wb::after,#board .bb::after{content:""}#board .wq::after,#board .bq::after{content:""}#board .wk::after,#board .bk::after{content:""}#board .wp::after,#board .bp::after{content:""}#board.r180{transform:rotate(180deg)}#board.r180 .wr,#board.r180 .wn,#board.r180 .wb,#board.r180 .wq,#board.r180 .wk,#board.r180 .wp,#board.r180 .br,#board.r180 .bn,#board.r180 .bb,#board.r180 .bq,#board.r180 .bk,#board.r180 .bp{transform:rotate(180deg)}#board .r{height:0vmin!important;position:relative}#board .f{height:4vmin!important;background-color:#222!important}#board .r{width:4vmin!important;background-color:#222!important}#board .dot::after{content:"";margin:auto;background-color:#333;border-radius:50%;display:block;height:1.5vmin;width:1.5vmin}#board .dot.lit::after{background-color:#F0FFFF!important;box-shadow:0 0 4px #F0FFFF,0 0 4px #F0FFFF}.backlit{letter-spacing:0.5px;color:#333}.backlit.lit{color:#F0FFFF;text-shadow:0 0 2px #F0FFFF,0 0 4px #F0FFFF}.center{text-align:center}.monospace{font-family:monospace}.container{margin:0vmin 4vmin}h3{font-size:4.5vmin}</style>
<style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body>
 <h3 class="container center monospace">
 <span id=check class=backlit>check</span><span id=mate class=backlit>mate&nbsp;</span>
 </h3>
 <table id=board border=0 cellspacing=0 cellpadding=0>
 <tbody><tr>
 <td id=r8 class="r dot"></td>
 <td id=a8 class=s></td>
 <td id=b8 class=s></td>
 <td id=c8 class=s></td>
 <td id=d8 class=s></td>
 <td id=e8 class=s></td>
 <td id=f8 class=s></td>
 <td id=g8 class=s></td>
 <td id=h8 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r7 class="r dot"></td>
 <td id=a7 class=s></td>
 <td id=b7 class=s></td>
 <td id=c7 class=s></td>
 <td id=d7 class=s></td>
 <td id=e7 class=s></td>
 <td id=f7 class=s></td>
 <td id=g7 class=s></td>
 <td id=h7 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r6 class="r dot"></td>
 <td id=a6 class=s></td>
 <td id=b6 class=s></td>
 <td id=c6 class=s></td>
 <td id=d6 class=s></td>
 <td id=e6 class=s></td>
 <td id=f6 class=s></td>
 <td id=g6 class=s></td>
 <td id=h6 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r5 class="r dot"></td>
 <td id=a5 class=s></td>
 <td id=b5 class=s></td>
 <td id=c5 class=s></td>
 <td id=d5 class=s></td>
 <td id=e5 class=s></td>
 <td id=f5 class=s></td>
 <td id=g5 class=s></td>
 <td id=h5 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r4 class="r dot"></td>
 <td id=a4 class=s></td>
 <td id=b4 class=s></td>
 <td id=c4 class=s></td>
 <td id=d4 class=s></td>
 <td id=e4 class=s></td>
 <td id=f4 class=s></td>
 <td id=g4 class=s></td>
 <td id=h4 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r3 class="r dot"></td>
 <td id=a3 class=s></td>
 <td id=b3 class=s></td>
 <td id=c3 class=s></td>
 <td id=d3 class=s></td>
 <td id=e3 class=s></td>
 <td id=f3 class=s></td>
 <td id=g3 class=s></td>
 <td id=h3 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r2 class="r dot"></td>
 <td id=a2 class=s></td>
 <td id=b2 class=s></td>
 <td id=c2 class=s></td>
 <td id=d2 class=s></td>
 <td id=e2 class=s></td>
 <td id=f2 class=s></td>
 <td id=g2 class=s></td>
 <td id=h2 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td id=r1 class="r dot"></td>
 <td id=a1 class=s></td>
 <td id=b1 class=s></td>
 <td id=c1 class=s></td>
 <td id=d1 class=s></td>
 <td id=e1 class=s></td>
 <td id=f1 class=s></td>
 <td id=g1 class=s></td>
 <td id=h1 class=s></td>
 <td class=r></td>
 </tr>
 <tr>
 <td class="r f"></td>
 <td id=fa class="f dot"></td>
 <td id=fb class="f dot"></td>
 <td id=fc class="f dot"></td>
 <td id=fd class="f dot"></td>
 <td id=fe class="f dot"></td>
 <td id=ff class="f dot"></td>
 <td id=fg class="f dot"></td>
 <td id=fh class="f dot"></td>
 <td class=r></td>
 </tr>
 </table>
 <script>
    setTimeout(() => {
      // initialize board
      window.game = new Game();
      game.render();
    });
  </script>
